<!doctype html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnostic Life Skills - Mission Locale Pays Basque</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    :root {
      /* Palette Mission Locale Pays Basque */
      --mlpb-orange: #f39200;
      --mlpb-green:  #95c11f;
      --mlpb-blue:   #2897d5;
      --mlpb-pink:   #d60b52;
      --mlpb-violet: #a3195b;
      --mlpb-red:    #9f3d3f;
      --mlpb-black:  #171718;
      --bg-main:     #ffffff;
      --bg-light:    #f7f9fb;
      --border-soft: #e2e8f0;
      --text-main:   #111827;
      --text-muted:  #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                   sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
    }

    .container {
      max-width: 1080px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
      overflow: hidden;
    }

    .header {
      position: relative;
      padding: 24px 32px 20px 32px;
      background: linear-gradient(90deg, #ffffff 0%, #fdf5ec 40%, #ebf5fe 100%);
      border-bottom: 3px solid var(--mlpb-orange);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .logo-left,
    .logo-container {
      background: #ffffff;
      border-radius: 12px;
      padding: 8px 12px;
      border: 1px solid var(--border-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      max-height: 56px;
    }

    .logo-left img,
    .logo-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .header-main {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 4px;
    }

    .header h1 {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--mlpb-black);
      letter-spacing: 0.03em;
    }

    .header-subline {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .header-tag {
      padding: 4px 10px;
      border-radius: 999px;
      background: #fff7ed;
      color: var(--mlpb-orange);
      font-weight: 600;
      font-size: 0.8rem;
      border: 1px solid #fed7aa;
    }

    .header p {
      margin: 4px 0 0 0;
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    main.content {
      padding: 28px 32px 32px 32px;
      background: var(--bg-main);
    }

    .step {
      display: none;
    }
    .step.active {
      display: block;
    }

    .intro-section {
      margin-bottom: 24px;
    }

    .intro-section h2 {
      margin: 0 0 10px 0;
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--mlpb-black);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .intro-section p {
      margin: 4px 0;
      font-size: 0.95rem;
      color: var(--text-muted);
    }

    .intro-context {
      margin-top: 14px;
      padding: 14px 16px;
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid var(--border-soft);
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .intro-context ul {
      margin: 6px 0 0 16px;
      padding: 0;
    }

    .intro-context li {
      margin-bottom: 4px;
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .form-group input[type="text"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      font-size: 0.95rem;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .form-group input[type="text"]:focus {
      outline: none;
      border-color: var(--mlpb-blue);
      box-shadow: 0 0 0 3px rgba(40, 151, 213, 0.15);
    }

    .helper-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 3px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    button.btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 10px 18px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: var(--mlpb-blue);
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
    }

    button.btn:hover:not(:disabled) {
      background: #1f7cb1;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.15);
      transform: translateY(-1px);
    }

    button.btn:disabled {
      cursor: not-allowed;
      opacity: 0.6;
      box-shadow: none;
    }

    .btn-secondary {
      background: #ffffff;
      color: var(--mlpb-blue);
      border-color: var(--mlpb-blue);
    }

    .btn-secondary:hover:not(:disabled) {
      background: #eff6ff;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border-color: var(--border-soft);
    }

    .btn-ghost:hover:not(:disabled) {
      background: #f3f4f6;
      color: var(--text-main);
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #f3f4f6;
      margin-bottom: 18px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      width: 0;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--mlpb-orange), var(--mlpb-blue));
      transition: width 0.35s ease;
    }

    .domain-section {
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 18px 18px 16px 18px;
      margin-bottom: 20px;
    }

    .domain-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 6px;
    }

    .domain-title-main {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .domain-icon {
      font-size: 1.4rem;
    }

    .domain-text {
      font-weight: 700;
      font-size: 1rem;
      color: var(--mlpb-black);
    }

    .domain-chip {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eff6ff;
      color: var(--mlpb-blue);
      border: 1px solid #bfdbfe;
    }

    .domain-objective {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 10px;
    }

    .domain-objective strong {
      color: var(--mlpb-black);
    }

    .question {
      margin-bottom: 12px;
      padding: 10px 10px 8px 10px;
      border-radius: 10px;
      background: #f9fafb;
    }

    .question-text {
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .rating-scale {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    .rating-option {
      position: relative;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      padding: 8px 8px;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s, transform 0.05s;
    }

    .rating-option input[type="radio"] {
      margin: 0;
      accent-color: var(--mlpb-blue);
    }

    .rating-label {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .rating-label span:first-child {
      font-weight: 600;
    }

    .rating-label span:last-child {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .rating-option[data-value="1"] {
      border-color: #fecaca;
    }
    .rating-option[data-value="2"] {
      border-color: #fee2b3;
    }
    .rating-option[data-value="3"] {
      border-color: #bbf7d0;
    }
    .rating-option[data-value="4"] {
      border-color: #ddd6fe;
    }

    .rating-option:hover {
      background: #f3f4f6;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.06);
    }

    .rating-option:has(input[type="radio"]:checked") {
      transform: translateY(-1px);
    }

    .rating-option:has(input[type="radio"]:checked)[data-value="1"] {
      background: #fee2e2;
      border-color: #f97373;
    }
    .rating-option:has(input[type="radio"]:checked)[data-value="2"] {
      background: #fef3c7;
      border-color: #facc15;
    }
    .rating-option:has(input[type="radio"]:checked)[data-value="3"] {
      background: #dcfce7;
      border-color: #22c55e;
    }
    .rating-option:has(input[type="radio"]:checked)[data-value="4"] {
      background: #ede9fe;
      border-color: #8b5cf6;
    }

    .nav-row {
      margin-top: 18px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .results-section h2 {
      margin-top: 0;
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--mlpb-black);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .radar-container {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 14px;
      margin-bottom: 10px;
    }

    .chart-container {
      flex: 1 1 280px;
      background: #f9fafb;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 14px 16px;
    }

    .chart-title {
      font-size: 0.95rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--mlpb-black);
    }

    .life-skills-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .skill-card {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 10px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.9rem;
    }

    .skill-name {
      font-weight: 600;
      color: var(--text-main);
    }

    .skill-score {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--mlpb-violet);
    }

    .domain-bars {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 8px;
      margin-top: 4px;
    }

    .domain-bar {
      background: #ffffff;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 8px 10px;
      font-size: 0.85rem;
    }

    .domain-bar-name {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .bar-container {
      background: #f3f4f6;
      border-radius: 999px;
      overflow: hidden;
      height: 18px;
    }

    .bar-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--mlpb-green), var(--mlpb-blue));
      color: #ffffff;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      transition: width 0.4s ease;
    }

    .priority-areas,
    .action-plan {
      margin-top: 18px;
      border-radius: 14px;
      padding: 14px 16px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      font-size: 0.9rem;
    }

    .priority-title,
    .action-title {
      font-size: 1rem;
      font-weight: 700;
      color: var(--mlpb-black);
      margin-bottom: 8px;
    }

    .saved-assessments {
      background: #f9fafb;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      padding: 12px 14px;
      margin-bottom: 14px;
    }

    .saved-assessments h3 {
      margin: 0 0 6px 0;
      font-size: 0.95rem;
      font-weight: 700;
    }

    .assessment-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 8px 0;
      border-top: 1px solid #e5e7eb;
      font-size: 0.85rem;
    }

    .assessment-item:first-of-type {
      border-top: none;
    }

    .assessment-name {
      font-weight: 600;
    }

    .assessment-date {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .btn-small {
      padding: 6px 12px;
      font-size: 0.8rem;
    }

    .activities-intro {
      margin-top: 8px;
      margin-bottom: 12px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .activity-card {
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      padding: 14px 16px;
      margin-bottom: 12px;
      font-size: 0.9rem;
    }

    .activity-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .activity-icon {
      font-size: 1.4rem;
    }

    .activity-title {
      margin: 0;
      font-size: 1rem;
      font-weight: 700;
      color: var(--mlpb-black);
    }

    .activity-subtitle {
      margin: 2px 0 0 0;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .skills-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 8px 0;
    }

    .skill-tag {
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 999px;
      background: #ecfeff;
      color: #0f766e;
      border: 1px solid #a5f3fc;
    }

    .activity-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }

    .meta-item {
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 999px;
      background: #f3f4f6;
      color: var(--text-muted);
    }

    .activity-steps h4 {
      margin: 8px 0 4px 0;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .step-list {
      list-style: disc;
      padding-left: 20px;
      margin: 0;
    }

    .step-item {
      margin-bottom: 4px;
      font-size: 0.85rem;
    }

    .transfer-note {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f0f9ff;
      border: 1px solid #bfdbfe;
      font-size: 0.85rem;
    }

    .transfer-title {
      font-weight: 600;
      margin-bottom: 2px;
      color: #1d4ed8;
    }

    .loading {
      display: none;
      text-align: center;
      margin-top: 10px;
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .spinner {
      border: 3px solid #e5e7eb;
      border-top: 3px solid var(--mlpb-blue);
      border-radius: 50%;
      width: 26px;
      height: 26px;
      margin: 0 auto 6px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .inline-message {
      position: fixed;
      z-index: 1000;
      right: 20px;
      top: 20px;
      max-width: 320px;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 0.85rem;
      color: #ffffff;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.25);
      animation: slideIn 0.2s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-8px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      .container {
        border-radius: 12px;
      }
      .header {
        padding: 16px 16px 12px 16px;
      }
      main.content {
        padding: 18px 16px 20px 16px;
      }
      .rating-scale {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
      .life-skills-grid {
        grid-template-columns: 1fr;
      }
      .inline-message {
        left: 10px;
        right: 10px;
        top: 10px;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
</head>
<body>
<div class="container">
  <header class="header" aria-label="En-t√™te du diagnostic Life Skills">
    <div class="header-top">
      <div class="logo-left" aria-label="Logo Mission Locale Pays Basque">
        <img src="https://static.wixstatic.com/media/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif/v1/fill/w_313,h_84,al_c,lg_1,q_80,enc_avif,quality_auto/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif"
             alt="Mission Locale Pays Basque"
             onerror="this.src=''; this.alt='Logo Mission Locale indisponible'; this.style.display='none';">
      </div>
      <div class="logo-container" aria-label="Logo LS4YOU">
        <img src="https://static.wixstatic.com/media/dd5dab_31e98305be67485d92cdb56f82c0e03f~mv2.png/v1/fill/w_560,h_224,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LS4YOU_Logo.png"
             alt="Life Skills for Youth - LS4YOU"
             onerror="this.src=''; this.alt='Logo LS4YOU indisponible'; this.style.display='none';">
      </div>
    </div>
    <div class="header-main">
      <h1 id="toolTitle">Diagnostic Life Skills</h1>
      <div class="header-subline">
        <span id="organizationName">Mission Locale Pays Basque</span>
        <span class="header-tag">Outil de rep√©rage - positionnement - √©volution</span>
      </div>
      <p id="headerDescription">
        Ce diagnostic structure l‚Äô√©change autour de 11 domaines de vie et recode les r√©ponses
        dans les 4 axes Life Skills pour construire un parcours d‚Äôaccompagnement coh√©rent.
      </p>
    </div>
  </header>

  <main class="content" id="mainContent" role="main" aria-live="polite">
    <!-- √âtape 1: Accueil et diagnostics sauvegard√©s -->
    <section class="step active" id="step-welcome" aria-label="Accueil diagnostic Life Skills">
      <div class="intro-section">
        <h2>üéØ Bienvenue dans le diagnostic Life Skills</h2>
        <p id="instructionsText">
          Ce diagnostic vous permet de rep√©rer les forces et les besoins d‚Äôun jeune dans 11 domaines
          essentiels √† l‚Äôinsertion sociale et professionnelle, avec une lecture Life Skills.
        </p>
        <div class="intro-context" aria-label="Comment utiliser ce diagnostic">
          <strong>üß≠ Usage conseill√© en Mission Locale (logique RPE) :</strong>
          <ul>
            <li><strong>Niveau 1 ‚Äì Autonome :</strong> le jeune remplit le questionnaire en ligne (avec ou sans aide).</li>
            <li><strong>Niveau 2 ‚Äì Entretien :</strong> le conseiller s‚Äôen sert comme fil de discussion en face-√†-face.</li>
            <li><strong>Niveau 3 ‚Äì Collectif :</strong> les r√©sultats orientent vers des ateliers th√©matiques Life Skills.</li>
          </ul>
          <p style="margin-top:6px;">
            L‚Äôobjectif n‚Äôest pas de ‚Äúnoter‚Äù le jeune, mais de <strong>partager un langage commun</strong> sur les
            situations de vie et les comp√©tences √† consolider.
          </p>
        </div>
      </div>

      <div class="saved-assessments" id="savedAssessments" style="display:none;">
        <h3>üìã Diagnostics pr√©c√©demment enregistr√©s (backend)</h3>
        <div id="assessmentsList"></div>
      </div>

      <div class="form-group">
        <label for="participantName">Pr√©nom et nom du jeune</label>
        <input type="text"
               id="participantName"
               placeholder="Ex : Marie Dupont"
               aria-required="true"
               aria-label="Pr√©nom et nom du jeune">
        <div class="helper-text">
          Ce nom appara√Ætra sur la synth√®se PDF et dans le suivi RPE.
        </div>
      </div>

      <div id="localStorageInfo" class="helper-text" style="display:none; margin-bottom:8px;">
        üíæ Un diagnostic non termin√© a √©t√© retrouv√© sur cet appareil.
      </div>

      <div class="btn-row">
        <button class="btn"
                type="button"
                onclick="startAssessment()"
                aria-label="Commencer un nouveau diagnostic">
          <span>Commencer le diagnostic</span>
        </button>
        <button class="btn btn-secondary"
                type="button"
                id="resumeBtn"
                style="display:none;"
                onclick="resumeLastAssessment()"
                aria-label="Reprendre le dernier diagnostic sauvegard√© sur cet appareil">
          ‚Ü∫ Reprendre le dernier diagnostic
        </button>
      </div>
    </section>

    <!-- √âtape 2: Questions par domaine -->
    <section class="step" id="step-assessment" aria-label="Questions par domaine">
      <div class="progress-bar" role="progressbar"
           aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div id="questionsContainer"></div>
      <div class="nav-row">
        <button class="btn btn-secondary"
                type="button"
                onclick="previousDomain()"
                id="prevBtn"
                style="display:none;"
                aria-label="Revenir au domaine pr√©c√©dent">
          ‚Üê Pr√©c√©dent
        </button>
        <button class="btn"
                type="button"
                onclick="nextDomain()"
                id="nextBtn"
                aria-label="Passer au domaine suivant">
          Suivant ‚Üí
        </button>
      </div>
    </section>

    <!-- √âtape 3: R√©sultats -->
    <section class="step" id="step-results" aria-label="R√©sultats du diagnostic">
      <div class="results-section">
        <h2>üìä Synth√®se Life Skills & domaines de vie</h2>
        <p class="activities-intro">
          Cette synth√®se met en regard les 11 domaines d‚Äôinsertion et les 4 axes Life Skills pour
          pr√©parer le plan d‚Äôaction et le choix des ateliers / mini-parcours.
        </p>

        <div class="radar-container">
          <div class="chart-container">
            <div class="chart-title">üß† Lecture par axes Life Skills</div>
            <div class="life-skills-grid" id="lifeSkillsResults"></div>
          </div>
          <div class="chart-container">
            <div class="chart-title">üìà Lecture par domaines d‚Äôinsertion</div>
            <div class="domain-bars" id="domainResults"></div>
          </div>
        </div>

        <div class="priority-areas" id="priorityAreas"></div>
        <div class="action-plan">
          <div class="action-title">üí¨ Questions rep√®res pour le debrief RPE</div>
          <div id="debriefQuestions">
            <p><strong>1. Ce que le jeune fait d√©j√† bien :</strong></p>
            <p><em>Quels domaines ressortent comme forces ? Comment les valoriser dans le projet ?</em></p>
            <p><strong>2. Ce qui freine aujourd‚Äôhui :</strong></p>
            <p><em>Quels domaines en ‚Äúzone de d√©fi‚Äù p√®sent le plus sur le projet ou le quotidien ?</em></p>
            <p><strong>3. Ce qui peut √™tre travaill√© maintenant :</strong></p>
            <p><em>Sur quelles comp√©tences concr√®tes (Life Skills) peut-on agir dans les 3 prochains mois ?</em></p>
          </div>
        </div>

        <div class="action-plan" id="actionPlan"></div>

        <div class="nav-row" style="margin-top:16px;">
          <button class="btn btn-secondary"
                  type="button"
                  onclick="restartAssessment()"
                  aria-label="Lancer un nouveau diagnostic">
            Nouveau diagnostic
          </button>
          <button class="btn"
                  type="button"
                  onclick="saveResults()"
                  id="saveBtn"
                  aria-label="Sauvegarder le diagnostic dans le backend">
            üíæ Sauvegarder (backend)
          </button>
          <button class="btn btn-ghost"
                  type="button"
                  onclick="exportAsPDF()"
                  aria-label="Exporter les r√©sultats en PDF">
            üñ®Ô∏è Exporter en PDF
          </button>
          <button class="btn"
                  type="button"
                  onclick="showActivities()"
                  style="background: var(--mlpb-green);"
                  aria-label="Voir les activit√©s Life Skills recommand√©es">
            üéØ Voir les activit√©s
          </button>
        </div>

        <div class="loading" id="loading">
          <div class="spinner" role="status" aria-label="Chargement en cours"></div>
          <p>Sauvegarde en cours...</p>
        </div>
      </div>
    </section>

    <!-- √âtape 4: Activit√©s par domaine -->
    <section class="step" id="step-activities" aria-label="Activit√©s adapt√©es aux besoins rep√©r√©s">
      <div class="results-section">
        <h2>üéØ Activit√©s LS4YOU adapt√©es au profil</h2>
        <p class="activities-intro">
          Les activit√©s propos√©es ci-dessous sont directement li√©es aux domaines les plus fragiles
          et aux axes Life Skills concern√©s. Elles peuvent √™tre mobilis√©es en atelier collectif ou
          en travail individualis√©.
        </p>
        <div id="activitiesContainer"></div>
        <div class="nav-row" style="margin-top:16px;">
          <button class="btn btn-secondary"
                  type="button"
                  onclick="showStep('step-results')"
                  aria-label="Retourner √† la page de synth√®se">
            ‚Üê Retour aux r√©sultats
          </button>
          <button class="btn"
                  type="button"
                  onclick="restartAssessment()"
                  aria-label="Lancer un nouveau diagnostic">
            Nouveau diagnostic
          </button>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  // --- CONFIG APPLI / CONSTANTES ---

  const STORAGE_KEY = "mlpb_lifeskills_diag_v1";

  const lifeSkillsMapping = {
    "Personnalit√©": ["Orientation", "Sant√©", "Mode de vie"],
    "Valorisation": ["Emploi", "Formation", "Citoyennet√©"],
    "Bien-√™tre": ["Sant√©", "Logement", "Loisirs"],
    "Ressources": ["Mobilit√©", "Finances", "Num√©rique"]
  };

  const domains = [
    {
      name: "Emploi",
      icon: "üíº",
      objective:
        "√âvaluer la capacit√© √† se pr√©senter, comprendre les codes professionnels, demander de l'aide, se projeter dans le travail.",
      questions: [
        "M√™me sans dipl√¥me, je sais mettre en avant mes qualit√©s",
        "Face √† un employeur, j'arrive √† expliquer pourquoi il devrait me recruter",
        "Quand on me donne une mission, je comprends ce qu'on attend de moi",
        "Si j'ai des difficult√©s au travail, j'ose demander de l'aide",
        "Il y a au moins un type de m√©tier o√π je me projette"
      ],
      lifeSkills: {
        "Personnalit√©": "motivation / choix / forces",
        "Valorisation": "parler de soi / pitch",
        "Bien-√™tre": "stress entretien, pression",
        "Ressources": "salaire / contrats"
      }
    },
    {
      name: "Formation",
      icon: "üìö",
      objective:
        "√âvaluer concentration, pers√©v√©rance, rapport √† l'erreur, capacit√© √† poser des questions.",
      questions: [
        "M√™me si l'√©cole √©tait difficile, je peux me concentrer sur ce qui m'int√©resse",
        "Je peux suivre une formation sur plusieurs jours sans abandonner",
        "En cours, j'ose poser des questions si je ne comprends pas",
        "Les examens me stressent mais ne me paralysent pas",
        "Si une formation peut m'aider, je suis pr√™t¬∑e √† faire des efforts"
      ],
      lifeSkills: {
        "Personnalit√©": "pers√©v√©rance / rapport √† l'effort",
        "Valorisation": "reconnaissance des progr√®s",
        "Bien-√™tre": "charge mentale / stress scolaire",
        "Ressources": "aides formation"
      }
    },
    {
      name: "Orientation",
      icon: "üß≠",
      objective:
        "√âvaluer int√©r√™ts, valeurs, forces, id√©es d'avenir, flexibilit√© face aux r√©ajustements.",
      questions: [
        "J'ai au moins une id√©e de ce que je pourrais faire plus tard",
        "Je sais ce qui me pla√Æt dans la vie, m√™me si ce n'est pas scolaire",
        "Il y a des domaines o√π je me d√©brouille mieux que d'autres",
        "J'ai le droit de me tromper et de changer de voie",
        "M√™me dans l'incertitude, je vois quelques pistes pour avancer"
      ],
      lifeSkills: {
        "Personnalit√©": "int√©r√™ts / valeurs",
        "Valorisation": "confiance / identit√©",
        "Bien-√™tre": "anxi√©t√© orientation",
        "Ressources": "r√©alit√©s m√©tiers / contraintes"
      }
    },
    {
      name: "Mobilit√©",
      icon: "üöó",
      objective:
        "Observer organisation, autonomie, acc√®s aux transports, gestion du stress li√© aux d√©placements.",
      questions: [
        "Quand j'ai un rendez-vous important, j'arrive √† m'y rendre",
        "J'ai au moins un moyen de me d√©placer (m√™me si c'est compliqu√©)",
        "Si je dois aller quelque part de nouveau, je peux demander comment faire",
        "Parfois les transports me posent des probl√®mes (argent, stress, organisation)",
        "Je sais vers qui me tourner si j'ai un probl√®me de transport"
      ],
      lifeSkills: {
        "Personnalit√©": "autonomie",
        "Valorisation": "fiabilit√© (√™tre √† l'heure)",
        "Bien-√™tre": "anxi√©t√© trajets",
        "Ressources": "permis / co√ªt / r√©seau"
      }
    },
    {
      name: "Sant√©",
      icon: "‚ù§Ô∏è",
      objective:
        "√âvaluer √©nergie, stress, strat√©gies de r√©gulation, rep√©rage des signaux physiques et psychiques.",
      questions: [
        "En g√©n√©ral, j'ai l'√©nergie pour faire ce que j'ai √† faire",
        "Je sens quand √ßa ne va pas dans ma t√™te ou mon corps",
        "J'ai ma fa√ßon √† moi de d√©compresser quand √ßa va mal",
        "Il y a au moins une personne √† qui je peux dire que √ßa ne va pas",
        "Ma sant√© (physique ou mentale) me complique parfois les choses"
      ],
      lifeSkills: {
        "Personnalit√©": "limites personnelles",
        "Valorisation": "se sentir digne de soin",
        "Bien-√™tre": "c≈ìur du domaine",
        "Ressources": "acc√®s aux soins"
      }
    },
    {
      name: "Logement",
      icon: "üè°",
      objective:
        "Comprendre l'impact du logement sur le quotidien, la s√©curit√©, le sommeil et la capacit√© √† avancer dans un projet.",
      questions: [
        "J'ai un endroit o√π dormir en s√©curit√©",
        "Chez moi, je peux me reposer tranquillement quand j'en ai besoin",
        "Mon logement me permet d'aller √† mes rendez-vous et activit√©s",
        "Si ma situation de logement changeait, je saurais qui contacter"
      ],
      lifeSkills: {
        "Personnalit√©": "estime ‚Äì je m√©rite un lieu stable",
        "Valorisation": "capacit√© √† demander un accompagnement",
        "Bien-√™tre": "sommeil / s√©curit√©",
        "Ressources": "logement / dispositifs"
      }
    },
    {
      name: "Citoyennet√©",
      icon: "üî¥",
      objective:
        "√âvaluer l'expression, la participation, la capacit√© √† demander du soutien et √† se sentir l√©gitime.",
      questions: [
        "Dans un petit groupe bienveillant, j'arrive √† dire ce que je pense",
        "Il y a au moins un adulte qui m'√©coute vraiment",
        "Je sais que j'ai des droits, m√™me si je ne connais pas tout",
        "S'il y avait un projet qui m'int√©resse, je pourrais m'y investir"
      ],
      lifeSkills: {
        "Personnalit√©": "sentiment d'agir",
        "Valorisation": "place dans les groupes",
        "Bien-√™tre": "environnement sain ou toxique",
        "Ressources": "droits / participation"
      }
    },
    {
      name: "Finances",
      icon: "üí∂",
      objective:
        "Explorer compr√©hension du budget, des aides, du stress financier et des arbitrages possibles.",
      questions: [
        "Je sais combien j'ai d'argent par mois (m√™me si ce n'est pas beaucoup)",
        "Je vois quand je vais avoir des difficult√©s financi√®res",
        "Je peux parler d'argent avec quelqu'un sans avoir honte",
        "Je sais qu'il y a des aides possibles (m√™me si je ne connais pas tout)",
        "Le manque d'argent m'emp√™che parfois de faire certaines choses"
      ],
      lifeSkills: {
        "Personnalit√©": "prise de d√©cision / priorisation",
        "Valorisation": "sortir de la honte financi√®re",
        "Bien-√™tre": "stress budget",
        "Ressources": "aides / gestion"
      }
    },
    {
      name: "Loisirs",
      icon: "üé®",
      objective:
        "Rep√©rer les activit√©s ressources qui soutiennent l‚Äô√©quilibre, la motivation et l‚Äôidentit√©.",
      questions: [
        "J'ai au moins une activit√© que j'aime faire qui me fait du bien",
        "Je prends du temps pour moi dans la semaine",
        "De temps en temps, je teste de nouvelles activit√©s ou endroits",
        "Mes activit√©s m'aident √† aller mieux ou √† avoir confiance",
        "Je vois un lien entre ce que j'aime et ce que je pourrais faire plus tard"
      ],
      lifeSkills: {
        "Personnalit√©": "go√ªts, talents",
        "Valorisation": "parler de ses passions comme forces",
        "Bien-√™tre": "r√©gulation √©motionnelle",
        "Ressources": "acc√®s activit√©"
      }
    },
    {
      name: "Num√©rique",
      icon: "üì±",
      objective:
        "√âvaluer l‚Äôacc√®s aux outils, les comp√©tences num√©riques essentielles et la s√©curit√© en ligne.",
      questions: [
        "J'ai acc√®s √† un t√©l√©phone et internet quand j'en ai besoin",
        "Je peux me d√©brouiller pour faire des d√©marches en ligne",
        "Je sais chercher des informations utiles sur internet",
        "Je fais attention √† ce que je poste sur les r√©seaux sociaux",
        "Si j'ai des difficult√©s avec le num√©rique, je sais √† qui demander"
      ],
      lifeSkills: {
        "Personnalit√©": "limites / choix / contr√¥le",
        "Valorisation": "pr√©sence en ligne pro",
        "Bien-√™tre": "gestion r√©seaux / pression sociale",
        "Ressources": "acc√®s num√©rique / d√©marches"
      }
    },
    {
      name: "Mode de vie",
      icon: "‚è≥",
      objective:
        "Comprendre comment le rythme quotidien impacte projet, √©nergie, disponibilit√© et fiabilit√©.",
      questions: [
        "Mes horaires de sommeil me permettent de tenir le coup",
        "Quand c'est important, j'arrive √† √™tre √† l'heure",
        "Je note mes rendez-vous importants pour ne pas les oublier",
        "J'arrive √† jongler entre mes diff√©rentes activit√©s",
        "Je sais quand j'ai besoin de faire une pause et je le fais"
      ],
      lifeSkills: {
        "Personnalit√©": "organisation personnelle / limites",
        "Valorisation": "fiabilit√© / ponctualit√©",
        "Bien-√™tre": "√©quilibre vie / r√©cup√©ration",
        "Ressources": "gestion du temps / outils"
      }
    }
  ];

  const domainActivities = {
    Emploi: [
      {
        title: "Mon Pitch en 30 secondes",
        objective: "Apprendre √† parler de soi simplement, de fa√ßon professionnelle et cr√©dible.",
        skills: ["Valorisation", "Personnalit√©"],
        duration: "45 min",
        format: "Individuel + vid√©o",
        steps: [
          "Compl√©ter 3 phrases : ¬´ Je suis‚Ä¶ ¬ª, ¬´ On me reconna√Æt souvent pour‚Ä¶ ¬ª, ¬´ Je suis dou√©¬∑e pour‚Ä¶ ¬ª",
          "Assembler ces √©l√©ments en un pitch simple et authentique",
          "Enregistrer une courte vid√©o de pr√©sentation",
          "Recueillir des retours bienveillants du groupe ou du conseiller"
        ],
        transfer: "Directement mobilisable en entretien d‚Äôembauche, en forum emploi ou devant un recruteur."
      }
    ],
    Formation: [
      {
        title: "Le Feedback qui fait grandir",
        objective: "Apprendre √† recevoir et √† demander un feedback utile (et pas blessant).",
        skills: ["Valorisation", "Bien-√™tre"],
        duration: "1h",
        format: "Collectif + bin√¥mes",
        steps: [
          "Mini-jeu : trier ¬´ bon feedback / mauvais feedback ¬ª √† partir d‚Äôexemples concrets",
          "Simuler des situations de feedback en bin√¥me (formation, stage, emploi)",
          "Identifier ce qui aide √† progresser dans un retour",
          "Formuler une action ¬´ je progresse dans‚Ä¶ ¬ª √† partir du feedback re√ßu",
          "Debrief collectif sur ce que chacun retient pour la suite"
        ],
        transfer: "Facilite l'apprentissage en formation et la relation avec les formateurs ou tuteurs."
      }
    ],
    Orientation: [
      {
        title: "Mon Mini Magazine de Vie (Zine)",
        objective: "Faire √©merger centres d‚Äôint√©r√™t, valeurs et images de vie souhait√©es.",
        skills: ["Personnalit√©", "Valorisation"],
        duration: "1h30",
        format: "Atelier cr√©atif individuel",
        steps: [
          "Choisir images/mots qui parlent de soi, de ses envies, de ses inspirations",
          "Structurer un mini-magazine : qui je suis / ce que j‚Äôaime / ce que je sais faire / o√π j‚Äôai envie d‚Äôaller",
          "Mettre en forme son zine (dessin, collage, num√©rique‚Ä¶)",
          "Pr√©sentation optionnelle au groupe avec droit de passer"
        ],
        transfer: "Support concret pour l‚Äôorientation, les bilans et la pr√©paration √† la rencontre avec des pros."
      }
    ],
    Mobilit√©: [
      {
        title: "Moi en d√©placement : choix & cons√©quences",
        objective:
          "Comprendre l‚Äôimpact des choix de mobilit√© sur l‚Äôacc√®s √† la formation, √† l‚Äôemploi et au r√©seau.",
        skills: ["Ressources", "Personnalit√©"],
        duration: "45 min",
        format: "Simulation pratique",
        steps: [
          "Choisir un sc√©nario : se rendre √† un entretien, √† une formation, √† un rendez-vous important",
          "Lister les solutions possibles (bus, covoiturage, v√©lo, marche, voiture‚Ä¶)",
          "Calculer dur√©e, co√ªt et contraintes de chaque option",
          "Rep√©rer les freins (horaires, anxi√©t√©, permis, finances‚Ä¶)",
          "Formuler une premi√®re √©tape concr√®te pour s√©curiser la mobilit√©"
        ],
        transfer: "Clarifie le ¬´ co√ªt r√©el ¬ª d‚Äôun projet et pr√©pare les d√©marches mobilit√© (permis, location solidaire‚Ä¶)."
      }
    ],
    Sant√©: [
      {
        title: "Mon Stressom√®tre",
        objective:
          "Rep√©rer ses signaux de stress et construire son kit personnel d‚Äôapaisement.",
        skills: ["Bien-√™tre", "Personnalit√©"],
        duration: "1h",
        format: "Auto-√©valuation + mise en pratique",
        steps: [
          "S‚Äôauto-positionner sur une √©chelle de stress (aujourd‚Äôhui / habituellement)",
          "Identifier ses signaux d‚Äôalerte (physiques, √©motionnels, comportements)",
          "Lister ce qui aide d√©j√† un peu (musique, sport, temps seul, amis‚Ä¶)",
          "Choisir 2 √† 3 strat√©gies √† tester dans les 7 prochains jours",
          "Tester une technique simple d‚Äôapaisement en direct (respiration, ancrage‚Ä¶)"
        ],
        transfer: "R√©duit l‚Äôimpact du stress sur les d√©marches, les entretiens et le maintien en formation/emploi."
      }
    ],
    Logement: [
      {
        title: "Mon Budget Logement",
        objective: "Visualiser le co√ªt r√©el d‚Äôun logement et ses implications sur le reste de la vie.",
        skills: ["Ressources"],
        duration: "45 min",
        format: "Calcul pratique √† partir de cas concrets",
        steps: [
          "Choisir un exemple de logement (annonce r√©elle ou cas type)",
          "Lister toutes les charges (loyer, √©nergie, internet, assurance, transport‚Ä¶)",
          "Comparer le total aux ressources actuelles/potentielles",
          "Identifier les leviers : colocation, autre secteur, aides logement, accompagnement",
          "D√©finir une trajectoire r√©aliste vers un logement plus stable"
        ],
        transfer: "Support pour travailler l‚Äôautonomie r√©sidentielle et pr√©parer les rencontres avec les partenaires logement."
      }
    ],
    Citoyennet√©: [
      {
        title: "Ma Carte de Soutien",
        objective:
          "Identifier clairement son r√©seau de soutien actuel et les manques √† combler.",
        skills: ["Valorisation", "Personnalit√©"],
        duration: "1h",
        format: "Cartographie individuelle + √©changes",
        steps: [
          "Dessiner ou sch√©matiser son r√©seau (famille, amis, pros, lieux ressources)",
          "Identifier les personnes/lieux ¬´ qui font du bien ¬ª",
          "Rep√©rer l√† o√π le jeune est seul ou en difficult√©",
          "Formuler un besoin de soutien concret (√©cole, sant√©, d√©marches, projet‚Ä¶)",
          "Choisir une premi√®re d√©marche s√©curis√©e (par ex. venir √† un RDV accompagn√©)"
        ],
        transfer: "Aide √† mobiliser la bonne ressource au bon moment et √† rompre l‚Äôisolement dans les moments cl√©s."
      }
    ],
    Finances: [
      {
        title: "Du Brut au Net",
        objective:
          "Comprendre la r√©alit√© d‚Äôun salaire et poser les bases d‚Äôun budget r√©aliste.",
        skills: ["Ressources"],
        duration: "1h",
        format: "Simulation budg√©taire",
        steps: [
          "Partir d‚Äôun exemple de salaire brut (emploi cibl√©) et le convertir en net approximatif",
          "Lister les d√©penses fixes (logement, transport, alimentation, forfaits‚Ä¶)",
          "Identifier ce qu‚Äôil reste pour les loisirs et impr√©vus",
          "Rep√©rer les tensions (d√©couvert, dettes, aides √† solliciter)",
          "√âlaborer une premi√®re esquisse de budget √©quilibr√©"
        ],
        transfer: "Support pour parler concr√®tement de r√©mun√©ration, de priorit√©s et d‚Äôautonomie financi√®re."
      }
    ],
    Loisirs: [
      {
        title: "Mes Boosters de Bien-√ätre",
        objective:
          "Mettre en lumi√®re les activit√©s qui nourrissent l‚Äô√©nergie et la motivation.",
        skills: ["Bien-√™tre"],
        duration: "30 min",
        format: "R√©flexion guid√©e + planification simple",
        steps: [
          "Lister ce qui fait du bien (activit√©s, lieux, personnes, ambiances)",
          "Choisir 2 ou 3 activit√©s faciles √† mettre en place dans la semaine",
          "V√©rifier leur faisabilit√© (co√ªt, transport, horaires, sant√©‚Ä¶)",
          "Inscrire ces activit√©s dans un planning simple",
          "S‚Äôengager sur une premi√®re action dans les 48 heures"
        ],
        transfer: "Contribue √† stabiliser le mode de vie et √† soutenir la pers√©v√©rance dans les projets."
      }
    ],
    Num√©rique: [
      {
        title: "Mon Image en Ligne",
        objective:
          "Prendre conscience de son identit√© num√©rique et la mettre en coh√©rence avec son projet.",
        skills: ["Valorisation", "Ressources"],
        duration: "1h",
        format: "Audit rapide + ajustements",
        steps: [
          "Faire un ¬´ Google test ¬ª de son nom/pr√©nom et observer les r√©sultats",
          "Parcourir ses profils de r√©seaux sociaux (photos, commentaires, bios‚Ä¶) avec un regard pro",
          "Rep√©rer ce qui peut poser probl√®me (contenus publics, propos, images‚Ä¶)",
          "Faire un nettoyage de base et renforcer la confidentialit√© si besoin",
          "Cr√©er/mettre √† jour un profil plus pro (CV en ligne, profil emploi, etc.)"
        ],
        transfer: "S√©curise la premi√®re impression des recruteurs et soutient une posture plus professionnelle."
      }
    ],
    "Mode de vie": [
      {
        title: "Ma routine qui me fait du bien",
        objective:
          "Mettre √† plat ses habitudes quotidiennes et construire une routine plus soutenante.",
        skills: ["Personnalit√©", "Bien-√™tre"],
        duration: "45 min",
        format: "Analyse + projection",
        steps: [
          "Rep√©rer les habitudes actuelles qui aident et celles qui fatiguent",
          "Choisir un ou deux petits changements possibles √† court terme",
          "Construire une journ√©e-type r√©aliste (sommeil, repas, d√©placements, √©crans‚Ä¶)",
          "D√©finir des indicateurs simples de r√©ussite (ex. : 2 matins √† l‚Äôheure cette semaine)",
          "Pr√©voir les obstacles probables et des solutions de contournement"
        ],
        transfer: "Renforce la r√©gularit√©, la fiabilit√© et la disponibilit√© pour les d√©marches et les engagements."
      }
    ]
  };

  const defaultConfig = {
    tool_title: "Diagnostic Life Skills",
    organization_name: "Mission Locale Edition",
    instructions_text:
      "Ce diagnostic vous permettra d'identifier vos forces et vos besoins dans 11 domaines essentiels √† votre insertion professionnelle et sociale."
  };

  let currentDomain = 0;
  let responses = {};
  let currentRecordCount = 0;
  let allAssessments = [];
  let lastSavedLocalAssessment = null;

  const dataHandler = {
    onDataChanged(data) {
      allAssessments = data;
      currentRecordCount = data.length;
      displaySavedAssessments();
    }
  };

  // --- INITIALISATION SDKs / CONFIG ---

  async function initializeApp() {
    try {
      if (window.dataSdk) {
        const initResult = await window.dataSdk.init(dataHandler);
        if (!initResult.isOk) {
          console.error("Erreur d'initialisation dataSdk");
        }
      }

      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const toolTitle = config.tool_title || defaultConfig.tool_title;
            const orgName = config.organization_name || defaultConfig.organization_name;
            const instructions = config.instructions_text || defaultConfig.instructions_text;

            document.getElementById("toolTitle").textContent = toolTitle;
            document.getElementById("organizationName").textContent = orgName;
            document.getElementById("instructionsText").textContent = instructions;
          },
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.primary_color || "#f39200",
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.setConfig({ primary_color: value });
                  }
                }
              },
              {
                get: () => config.secondary_color || "#2897d5",
                set: (value) => {
                  if (window.elementSdk) {
                    window.elementSdk.setConfig({ secondary_color: value });
                  }
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || "Montserrat",
              set: (value) => {
                if (window.elementSdk) {
                  window.elementSdk.setConfig({ font_family: value });
                }
              }
            },
            fontSizeable: {
              get: () => config.font_size || 16,
              set: (value) => {
                if (window.elementSdk) {
                  window.elementSdk.setConfig({ font_size: value });
                }
              }
            }
          }),
          mapToEditPanelValues: (config) =>
            new Map([
              ["tool_title", config.tool_title || defaultConfig.tool_title],
              ["organization_name", config.organization_name || defaultConfig.organization_name],
              ["instructions_text", config.instructions_text || defaultConfig.instructions_text]
            ])
        });
      }
    } catch (e) {
      console.error("Erreur d'initialisation globale :", e);
    }

    // Gestion localStorage
    lastSavedLocalAssessment = loadFromLocalStorage();
    if (lastSavedLocalAssessment) {
      const info = document.getElementById("localStorageInfo");
      const resumeBtn = document.getElementById("resumeBtn");
      if (info) info.style.display = "block";
      if (resumeBtn) resumeBtn.style.display = "inline-flex";
    }
  }

  // --- GESTION LOCALSTORAGE ---

  function saveToLocalStorage() {
    try {
      const participantName = document.getElementById("participantName").value || "";
      const payload = {
        participantName,
        responses,
        lastDomain: currentDomain,
        timestamp: new Date().toISOString()
      };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
    } catch (e) {
      console.warn("Impossible de sauvegarder dans localStorage :", e);
    }
  }

  function loadFromLocalStorage() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return null;
      return JSON.parse(raw);
    } catch (e) {
      console.warn("Impossible de charger localStorage :", e);
      return null;
    }
  }

  function resumeLastAssessment() {
    if (!lastSavedLocalAssessment) return;
    try {
      document.getElementById("participantName").value =
        lastSavedLocalAssessment.participantName || "";
      responses = lastSavedLocalAssessment.responses || {};
      currentDomain = lastSavedLocalAssessment.lastDomain || 0;

      generateQuestions();
      applyResponsesToForm();
      showStep("step-assessment");
      updateProgress();
      updateNavigationButtons();
      showInlineMessage("Diagnostic local recharg√©. Vous pouvez reprendre l√† o√π vous en √©tiez.", "success");
    } catch (e) {
      console.error("Erreur lors du rechargement local :", e);
      showInlineMessage("Impossible de reprendre le diagnostic local.", "error");
    }
  }

  function applyResponsesToForm() {
    domains.forEach((domain, dIndex) => {
      domain.questions.forEach((_, qIndex) => {
        const key = `q_${dIndex}_${qIndex}`;
        const value = responses[key];
        if (!value) return;
        const selector = `input[type="radio"][name="${key}"][value="${value}"]`;
        const input = document.querySelector(selector);
        if (input) {
          input.checked = true;
        }
      });
    });
  }

  // --- AFFICHAGE / NAVIGATION ---

  function displaySavedAssessments() {
    const container = document.getElementById("savedAssessments");
    const list = document.getElementById("assessmentsList");

    if (!container || !list) return;

    if (allAssessments.length === 0) {
      container.style.display = "none";
      return;
    }

    container.style.display = "block";
    list.innerHTML = "";

    allAssessments.forEach((assessment) => {
      const item = document.createElement("div");
      item.className = "assessment-item";

      const date = new Date(assessment.assessment_date);
      const formattedDate = date.toLocaleDateString("fr-FR");

      item.innerHTML = `
        <div class="assessment-info">
          <div class="assessment-name">${assessment.participant_name || "Diagnostic"}</div>
          <div class="assessment-date">Diagnostic du ${formattedDate}</div>
        </div>
        <button class="btn btn-small btn-ghost" type="button"
                aria-label="Voir les r√©sultats de ce diagnostic"
                onclick="viewAssessment('${assessment.__backendId}')">
          Voir
        </button>
      `;
      list.appendChild(item);
    });
  }

  function viewAssessment(assessmentId) {
    const assessment = allAssessments.find((a) => a.__backendId === assessmentId);
    if (!assessment) return;
    try {
      responses = JSON.parse(assessment.domain_scores);
    } catch {
      responses = {};
    }
    showResults();
    showStep("step-results");
  }

  function showStep(stepId) {
    const steps = document.querySelectorAll(".step");
    steps.forEach((step) => step.classList.remove("active"));
    const target = document.getElementById(stepId);
    if (target) {
      target.classList.add("active");
    }
  }

  // --- LOGIQUE QUESTIONNAIRE ---

  function startAssessment() {
    const nameInput = document.getElementById("participantName");
    const name = nameInput.value.trim();
    if (!name) {
      showInlineMessage("Merci de renseigner le pr√©nom et le nom du jeune avant de commencer.", "warning");
      nameInput.focus();
      return;
    }

    currentDomain = 0;
    responses = {};
    saveToLocalStorage();

    generateQuestions();
    showStep("step-assessment");
    updateProgress();
    updateNavigationButtons();
  }

  function generateQuestions() {
    const container = document.getElementById("questionsContainer");
    if (!container) return;
    container.innerHTML = "";

    domains.forEach((domain, domainIndex) => {
      const domainDiv = document.createElement("div");
      domainDiv.className = "domain-section";
      domainDiv.id = `domain-${domainIndex}`;
      domainDiv.setAttribute("role", "group");
      domainDiv.setAttribute(
        "aria-label",
        `Domaine ${domain.name} : ${domain.objective}`
      );
      if (domainIndex !== 0) {
        domainDiv.style.display = "none";
      }

      const lifeSkillsTooltip = Object.entries(domain.lifeSkills)
        .map(([axis, desc]) => `${axis} : ${desc}`)
        .join(" | ");

      domainDiv.innerHTML = `
        <div class="domain-title">
          <div class="domain-title-main">
            <span class="domain-icon" aria-hidden="true">${domain.icon}</span>
            <div class="domain-text">${domain.name}</div>
          </div>
          <div class="domain-chip"
               title="Axes Life Skills principaux : ${lifeSkillsTooltip}">
            4 axes Life Skills li√©s
          </div>
        </div>
        <div class="domain-objective">
          <strong>üéØ Objectif :</strong> ${domain.objective}
        </div>
      `;

      domain.questions.forEach((question, questionIndex) => {
        const questionDiv = document.createElement("div");
        questionDiv.className = "question";

        const questionId = `q_${domainIndex}_${questionIndex}`;

        questionDiv.innerHTML = `
          <div class="question-text">${question}</div>
          <div class="rating-scale" role="radiogroup"
               aria-label="√âchelle de positionnement pour cette affirmation">
            ${[1, 2, 3, 4]
              .map(
                (value) => `
              <label class="rating-option" data-value="${value}">
                <input type="radio"
                       name="${questionId}"
                       value="${value}"
                       aria-label="${getRatingAriaLabel(value)}"
                       onchange="updateResponse('${questionId}', ${value})">
                <span class="rating-label">
                  <span>${getRatingShortLabel(value)}</span>
                  <span>${getRatingLongLabel(value)}</span>
                </span>
              </label>
            `
              )
              .join("")}
          </div>
        `;

        domainDiv.appendChild(questionDiv);
      });

      container.appendChild(domainDiv);
    });
  }

  function getRatingShortLabel(value) {
    switch (value) {
      case 1:
        return "üî¥ Zone de d√©fi";
      case 2:
        return "üü° En progression";
      case 3:
        return "üü¢ Plut√¥t au point";
      case 4:
        return "‚≠ê C‚Äôest mon fort";
      default:
        return "";
    }
  }

  function getRatingLongLabel(value) {
    switch (value) {
      case 1:
        return "C‚Äôest difficile pour moi";
      case 2:
        return "J‚Äôy arrive parfois";
      case 3:
        return "Je me d√©brouille bien";
      case 4:
        return "Je ma√Ætrise vraiment";
      default:
        return "";
    }
  }

  function getRatingAriaLabel(value) {
    switch (value) {
      case 1:
        return "Zone de d√©fi : c‚Äôest difficile pour moi";
      case 2:
        return "En progression : j‚Äôy arrive parfois";
      case 3:
        return "Plut√¥t au point : je me d√©brouille bien";
      case 4:
        return "C‚Äôest mon fort : je ma√Ætrise vraiment";
      default:
        return "";
    }
  }

  function updateResponse(questionId, value) {
    responses[questionId] = value;
    saveToLocalStorage();
    updateNavigationButtons();
  }

  function updateNavigationButtons() {
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    if (!prevBtn || !nextBtn) return;

    prevBtn.style.display = currentDomain > 0 ? "inline-flex" : "none";

    if (currentDomain === domains.length - 1) {
      const allAnswered = domains[currentDomain].questions.every((_, qIndex) => {
        return responses[`q_${currentDomain}_${qIndex}`] !== undefined;
      });
      nextBtn.textContent = allAnswered ? "Voir mes r√©sultats" : "Terminer";
      nextBtn.disabled = !allAnswered;
    } else {
      nextBtn.textContent = "Suivant ‚Üí";
      nextBtn.disabled = false;
    }
  }

  function nextDomain() {
    if (currentDomain < domains.length - 1) {
      const allAnswered = domains[currentDomain].questions.every((_, qIndex) => {
        return responses[`q_${currentDomain}_${qIndex}`] !== undefined;
      });

      if (!allAnswered) {
        showInlineMessage(
          "Merci de r√©pondre √† toutes les affirmations de ce domaine avant de continuer.",
          "warning"
        );
        return;
      }

      document.getElementById(`domain-${currentDomain}`).style.display = "none";
      const completedDomain = domains[currentDomain].name;
      currentDomain++;
      document.getElementById(`domain-${currentDomain}`).style.display = "block";
      updateProgress();
      updateNavigationButtons();
      saveToLocalStorage();
      showInlineMessage(
        `Domaine ¬´ ${completedDomain} ¬ª compl√©t√©. Vous pouvez passer au suivant.`,
        "success"
      );
    } else {
      showResults();
      showStep("step-results");
    }
  }

  function previousDomain() {
    if (currentDomain > 0) {
      document.getElementById(`domain-${currentDomain}`).style.display = "none";
      currentDomain--;
      document.getElementById(`domain-${currentDomain}`).style.display = "block";
      updateProgress();
      updateNavigationButtons();
      saveToLocalStorage();
    }
  }

  function updateProgress() {
    const progress = ((currentDomain + 1) / domains.length) * 100;
    const fill = document.getElementById("progressFill");
    if (fill) {
      fill.style.width = `${progress}%`;
    }
    const bar = document.querySelector(".progress-bar");
    if (bar) {
      bar.setAttribute("aria-valuenow", Math.round(progress));
    }
  }

  // --- CALCUL / AFFICHAGE R√âSULTATS ---

  function showResults() {
    const domainScores = {};
    domains.forEach((domain, domainIndex) => {
      const domainResponses = domain.questions.map((_, qIndex) =>
        responses[`q_${domainIndex}_${qIndex}`] || 0
      );
      const average =
        domainResponses.reduce((a, b) => a + b, 0) / domainResponses.length;
      domainScores[domain.name] = Math.round((average / 4) * 100);
    });

    const lifeSkillsScores = {};
    Object.keys(lifeSkillsMapping).forEach((skill) => {
      const relatedDomains = lifeSkillsMapping[skill];
      const scores = relatedDomains.map((domainName) => domainScores[domainName]);
      const average = scores.reduce((a, b) => a + b, 0) / scores.length;
      lifeSkillsScores[skill] = Math.round(average);
    });

    displayLifeSkillsResults(lifeSkillsScores);
    displayDomainResults(domainScores);
    displayPriorityAreas(domainScores);
    displayActionPlan(domainScores);

    saveToLocalStorage();
  }

  function displayLifeSkillsResults(scores) {
    const container = document.getElementById("lifeSkillsResults");
    if (!container) return;
    container.innerHTML = "";

    Object.entries(scores).forEach(([skill, score]) => {
      const card = document.createElement("div");
      card.className = "skill-card";
      card.innerHTML = `
        <div class="skill-name">${skill}</div>
        <div class="skill-score">${score}%</div>
      `;
      container.appendChild(card);
    });
  }

  function displayDomainResults(scores) {
    const container = document.getElementById("domainResults");
    if (!container) return;
    container.innerHTML = "";

    Object.entries(scores).forEach(([domain, score]) => {
      const bar = document.createElement("div");
      bar.className = "domain-bar";
      bar.innerHTML = `
        <div class="domain-bar-name">${domain}</div>
        <div class="bar-container">
          <div class="bar-fill" style="width: ${score}%;">${score}%</div>
        </div>
      `;
      container.appendChild(bar);
    });
  }

  function displayPriorityAreas(scores) {
    const lowScoreAreas = Object.entries(scores)
      .filter(([_, score]) => score < 60)
      .sort((a, b) => a[1] - b[1])
      .map(([domain, score]) => ({ domain, score }));

    const container = document.getElementById("priorityAreas");
    if (!container) return;

    if (lowScoreAreas.length === 0) {
      container.innerHTML = `
        <div class="priority-title">üéâ Lecture globale</div>
        <p>Les scores sont globalement solides sur l‚Äôensemble des domaines.</p>
        <p><strong>Piste RPE :</strong> choisir 1 √† 2 domaines √† renforcer selon le projet du jeune
        (ex. : Emploi ou Formation) pour maintenir la dynamique.</p>
      `;
      return;
    }

    container.innerHTML = `
      <div class="priority-title">üéØ Domains √† travailler en priorit√©</div>
      <p>Ces domaines apparaissent comme les plus fragiles. Ils peuvent devenir des portes d‚Äôentr√©e
         de l‚Äôaccompagnement Life Skills :</p>
      <div style="margin:8px 0;">
        ${lowScoreAreas
          .map(
            ({ domain, score }) => `
          <label style="display:block; margin:4px 0; font-size:0.85rem; cursor:pointer;">
            <input type="checkbox" name="priority" value="${domain}"
                   onchange="updatePrioritySelection()" style="margin-right:6px;">
            <strong>${domain}</strong> (${score}%)
          </label>
        `
          )
          .join("")}
      </div>
      <p style="font-size:0.8rem; color:#6b7280;">
        S√©lectionnez 1 √† 3 domaines pour structurer le plan d‚Äôaction et les activit√©s LS4YOU associ√©es.
      </p>
      <div id="selectedPriorities" style="margin-top:6px; font-weight:600; color:#2897d5;"></div>
    `;
  }

  function updatePrioritySelection() {
    const checkboxes = document.querySelectorAll('input[name="priority"]:checked');
    const selected = Array.from(checkboxes).map((cb) => cb.value);
    const display = document.getElementById("selectedPriorities");
    if (!display) return;

    if (selected.length > 3) {
      checkboxes[checkboxes.length - 1].checked = false;
      selected.pop();
    }

    if (selected.length > 0) {
      display.textContent = `‚úÖ Domaines retenus pour le travail prioritaire : ${selected.join(", ")}`;
    } else {
      display.textContent = "";
    }
  }

  function displayActionPlan(scores) {
    const container = document.getElementById("actionPlan");
    if (!container) return;

    container.innerHTML = `
      <div class="action-title">üìã Plan d‚Äôaction : lecture Mission Locale</div>
      <div>${generateRecommendations(scores)}</div>
    `;
  }

  function generateRecommendations(scores) {
    const lowScores = Object.entries(scores)
      .filter(([_, score]) => score < 60)
      .sort((a, b) => a[1] - b[1]);

    if (lowScores.length === 0) {
      return `
        <p><strong>Maintien et mont√©e en puissance :</strong></p>
        <ul>
          <li>Capitaliser sur les domaines forts (mise en mouvement, engagement, mobilit√© internationale‚Ä¶)</li>
          <li>Partager les bonnes pratiques du jeune avec d‚Äôautres (pair √† pair, t√©moignages).</li>
          <li>Proposer des d√©fis / exp√©riences pour consolider les Life Skills d√©j√† robustes.</li>
        </ul>
      `;
    }

    const recommendations = {
      Emploi:
        "Travailler la pr√©sentation de soi (pitch, CV, simulation d‚Äôentretien) et clarifier les attentes des employeurs.",
      Formation:
        "Explorer les dispositifs adapt√©s, s√©curiser les premiers pas (visite, immersion) et travailler le rapport √† l‚Äôerreur.",
      Orientation:
        "Prendre le temps d‚Äôun travail sur les int√©r√™ts, valeurs et sc√©narios de vie possibles (bilans, rencontres m√©tiers).",
      Mobilit√©:
        "Cartographier les solutions existantes, rep√©rer les freins psychologiques et financiers, activer les aides mobilit√©.",
      Sant√©:
        "S√©curiser un relais sant√© (m√©decin, psychologue, structure jeunesse) et travailler les strat√©gies d‚Äôauto-r√©gulation.",
      Logement:
        "Activer les partenaires (CCAS, bailleurs, structures sp√©cialis√©es) et rendre lisible le parcours logement.",
      Citoyennet√©:
        "Renforcer la place du jeune dans des collectifs (associations, dispositifs de participation, projets engag√©s).",
      Finances:
        "Installer un budget simple et activer les aides disponibles, en travaillant la honte ou le d√©couragement li√© √† l‚Äôargent.",
      Loisirs:
        "Repositionner les loisirs comme ressources pour le bien-√™tre et l‚Äôestime de soi, pas comme ‚Äòperte de temps‚Äô.",
      Num√©rique:
        "S√©curiser l‚Äôusage du num√©rique (d√©marches en ligne, image pro) et valoriser les comp√©tences num√©riques d√©j√† l√†.",
      "Mode de vie":
        "Travailler sur une routine compatible avec le projet (sommeil, rythme, d√©placements, √©cran) et la fiabilit√©."
    };

    return `
      <p><strong>Actions prioritaires propos√©es :</strong></p>
      <ol>
        ${lowScores
          .slice(0, 3)
          .map(
            ([domain, _]) => `
          <li><strong>${domain}</strong> : ${
              recommendations[domain] ||
              "Co-construire une strat√©gie d‚Äôaccompagnement adapt√©e avec le jeune."
            }</li>
        `
          )
          .join("")}
      </ol>
      <p style="font-size:0.8rem; color:#6b7280;">
        Ce plan est une base de discussion : il doit √™tre ajust√© avec le jeune et l‚Äô√©quipe Mission Locale.
      </p>
    `;
  }

  // --- SAUVEGARDE BACKEND & PDF ---

  async function saveResults() {
    if (!window.dataSdk) {
      showInlineMessage("Sauvegarde backend indisponible sur cet outil. Les donn√©es locales restent enregistr√©es.", "warning");
      return;
    }

    if (currentRecordCount >= 999) {
      showInlineMessage(
        "Limite de 999 diagnostics atteinte. Merci de supprimer d‚Äôanciens enregistrements.",
        "error"
      );
      return;
    }

    const saveBtn = document.getElementById("saveBtn");
    const loading = document.getElementById("loading");

    saveBtn.disabled = true;
    if (loading) loading.style.display = "block";

    try {
      const participantName = document.getElementById("participantName").value || "Diagnostic Life Skills";

      const domainScores = {};
      domains.forEach((domain, domainIndex) => {
        const domainResponses = domain.questions.map((_, qIndex) =>
          responses[`q_${domainIndex}_${qIndex}`] || 0
        );
        const average =
          domainResponses.reduce((a, b) => a + b, 0) / domainResponses.length;
        domainScores[domain.name] = Math.round((average / 4) * 100);
      });

      const lifeSkillsScores = {};
      Object.keys(lifeSkillsMapping).forEach((skill) => {
        const relatedDomains = lifeSkillsMapping[skill];
        const scores = relatedDomains.map((domainName) => domainScores[domainName]);
        const average = scores.reduce((a, b) => a + b, 0) / scores.length;
        lifeSkillsScores[skill] = Math.round(average);
      });

      const priorityAreas = Object.entries(domainScores)
        .filter(([_, score]) => score < 60)
        .map(([domain, _]) => domain);

      const assessmentData = {
        participant_name: participantName,
        assessment_date: new Date().toISOString(),
        domain_scores: JSON.stringify(domainScores),
        life_skills_scores: JSON.stringify(lifeSkillsScores),
        priority_areas: JSON.stringify(priorityAreas),
        action_plan: generateRecommendations(domainScores),
        completed: true
      };

      const result = await window.dataSdk.create(assessmentData);
      if (result.isOk) {
        showInlineMessage("Diagnostic sauvegard√© dans le backend.", "success");
      } else {
        showInlineMessage("Erreur lors de la sauvegarde backend.", "error");
      }
    } catch (error) {
      console.error("Erreur sauvegarde backend :", error);
      showInlineMessage("Erreur lors de la sauvegarde. Merci de r√©essayer.", "error");
    } finally {
      saveBtn.disabled = false;
      if (loading) loading.style.display = "none";
    }
  }

  function exportAsPDF() {
    // Export simple via la fonction d‚Äôimpression du navigateur.
    // Pour un usage pro : impression depuis la page de synth√®se uniquement.
    window.print();
  }

  function restartAssessment() {
    currentDomain = 0;
    responses = {};
    document.getElementById("participantName").value = "";
    showStep("step-welcome");
    saveToLocalStorage();
  }

  // --- MESSAGES / FEEDBACK UX ---

  function showInlineMessage(message, type) {
    const messageDiv = document.createElement("div");
    messageDiv.className = "inline-message";
    messageDiv.setAttribute("role", "status");
    messageDiv.setAttribute("aria-live", "polite");

    if (type === "success") {
      messageDiv.style.background = "#16a34a";
    } else if (type === "error") {
      messageDiv.style.background = "#dc2626";
    } else {
      messageDiv.style.background = "#f59e0b";
    }

    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);

    setTimeout(() => {
      if (messageDiv.parentNode) {
        messageDiv.parentNode.removeChild(messageDiv);
      }
    }, 4000);
  }

  // --- ACTIVIT√âS RECOMMAND√âES ---

  function showActivities() {
    const domainScores = {};
    domains.forEach((domain, domainIndex) => {
      const domainResponses = domain.questions.map((_, qIndex) =>
        responses[`q_${domainIndex}_${qIndex}`] || 0
      );
      const average =
        domainResponses.reduce((a, b) => a + b, 0) / domainResponses.length;
      domainScores[domain.name] = Math.round((average / 4) * 100);
    });

    const priorityDomains = Object.entries(domainScores)
      .filter(([_, score]) => score < 60)
      .sort((a, b) => a[1] - b[1])
      .map(([domain, _]) => domain);

    const domainsToShow =
      priorityDomains.length > 0
        ? priorityDomains.slice(0, 3)
        : Object.entries(domainScores)
            .sort((a, b) => a[1] - b[1])
            .slice(0, 3)
            .map(([domain, _]) => domain);

    displayActivities(domainsToShow, domainScores);
    showStep("step-activities");
  }

  function displayActivities(priorityDomains, domainScores) {
    const container = document.getElementById("activitiesContainer");
    if (!container) return;
    container.innerHTML = "";

    if (priorityDomains.length === 0) {
      container.innerHTML = `
        <div class="activity-card">
          <p>Les scores ne mettent pas en avant de domaine en forte difficult√©.</p>
          <p><strong>Piste :</strong> choisir avec le jeune une activit√© LS4YOU en lien avec son projet principal
          (Emploi, Formation, Mobilit√© ou Orientation).</p>
        </div>
      `;
      return;
    }

    const intro = document.createElement("div");
    intro.className = "activity-card";
    intro.style.background = "#f0f9ff";
    intro.style.borderColor = "#bfdbfe";

    intro.innerHTML = `
      <h3 style="margin:0 0 6px 0; font-size:1rem;">üß© Mini-parcours Life Skills possible</h3>
      <p style="margin:0 0 6px 0; font-size:0.9rem;">
        √Ä partir du diagnostic, ces domaines peuvent structurer un mini-parcours
        (2 √† 4 s√©ances) combinant entretiens et ateliers LS4YOU.
      </p>
      <div style="display:flex; flex-wrap:wrap; gap:6px; margin-top:4px;">
        ${priorityDomains
          .map(
            (domain) => `
          <span class="meta-item" style="background:#eff6ff; color:#1d4ed8;">
            ${domain} (${domainScores[domain]}%)
          </span>
        `
          )
          .join("")}
      </div>
    `;
    container.appendChild(intro);

    priorityDomains.forEach((domainName) => {
      const activities = domainActivities[domainName];
      if (!activities) return;

      const domainIcon = domains.find((d) => d.name === domainName)?.icon || "üéØ";

      activities.forEach((activity) => {
        const activityCard = document.createElement("div");
        activityCard.className = "activity-card";

        activityCard.innerHTML = `
          <div class="activity-header">
            <div class="activity-icon" aria-hidden="true">${domainIcon}</div>
            <div>
              <h3 class="activity-title">${activity.title}</h3>
              <p class="activity-subtitle">Domaine : ${domainName}</p>
            </div>
          </div>

          <p style="margin:4px 0;"><strong>Objectif p√©dagogique :</strong> ${activity.objective}</p>

          <div class="skills-tags">
            ${activity.skills
              .map(
                (skill) =>
                  `<span class="skill-tag">Axe Life Skills : ${skill}</span>`
              )
              .join("")}
          </div>

          <div class="activity-meta">
            <div class="meta-item">‚è±Ô∏è ${activity.duration}</div>
            <div class="meta-item">üë• ${activity.format}</div>
          </div>

          <div class="activity-steps">
            <h4>üìã D√©roul√© type :</h4>
            <ul class="step-list">
              ${activity.steps
                .map((step) => `<li class="step-item">${step}</li>`)
                .join("")}
            </ul>
          </div>

          <div class="transfer-note">
            <div class="transfer-title">üîÑ Transfert dans le parcours Mission Locale :</div>
            <p>${activity.transfer}</p>
          </div>
        `;

        container.appendChild(activityCard);
      });
    });

    const finalNote = document.createElement("div");
    finalNote.className = "activity-card";
    finalNote.style.background = "#ecfdf3";
    finalNote.style.borderColor = "#bbf7d0";

    finalNote.innerHTML = `
      <h4 style="margin:0 0 4px 0;">üí° Conseils d‚Äôanimation</h4>
      <ul style="margin:0; padding-left:18px; font-size:0.9rem;">
        <li>Poser un cadre de s√©curit√© psychologique (non-jugement, droit de ne pas tout partager).</li>
        <li>Relier syst√©matiquement l‚Äôactivit√© aux 11 domaines et aux 4 axes Life Skills.</li>
        <li>Conclure chaque activit√© par un ¬´ petit pas ¬ª concret √† r√©aliser avant le prochain rendez-vous.</li>
      </ul>
    `;
    container.appendChild(finalNote);
  }

  // --- D√âMARRAGE ---

  document.addEventListener("DOMContentLoaded", initializeApp);
</script>
</body>
</html>


<!doctype html>
<html lang="fr">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diagnostic Life Skills - Mission Locale</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        /* PALETTE LS4YOU
           Rouge cerise : #D72638
           Turquoise : #29B6F6
           Menthe : #B2F2E6
           Jaune : #FFCC00
           Orange : #FFA451
           Blanc : #FFFFFF
           Noir texte : #111111
        */

        /* RESET GLOBAL + FOND CLAIR LS4YOU */
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Montserrat', 'Helvetica', 'Arial', sans-serif;
            background:
                radial-gradient(circle at 10% 20%, #B2F2E6 0, transparent 50%),
                radial-gradient(circle at 80% 0, #FFCC00 0, transparent 55%),
                radial-gradient(circle at 80% 80%, #29B6F6 0, transparent 55%),
                #FFFFFF;
            color: #111111;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #FFFFFF;
            border-radius: 24px;
            border: 2px solid #B2F2E6;
            box-shadow: 0 18px 45px rgba(0,0,0,0.06);
            overflow: hidden;
            position: relative;
        }

        /* BOULES / PUZZLE EN FOND DU CONTAINER */
        .container::before {
            content: '';
            position: absolute;
            top: -40px;
            right: -40px;
            width: 140px;
            height: 140px;
            background:
                radial-gradient(circle, #29B6F6 0 55%, transparent 56%);
            opacity: 0.28;
            z-index: 0;
        }

        .container::after {
            content: '';
            position: absolute;
            bottom: -50px;
            left: -40px;
            width: 160px;
            height: 160px;
            background:
                radial-gradient(circle, #FFCC00 0 55%, transparent 56%);
            opacity: 0.3;
            z-index: 0;
        }

        /* EN-T√äTE LS4YOU */
        .header {
            position: relative;
            padding: 40px 40px 32px 40px;
            background:
                radial-gradient(circle at 0 0, #B2F2E6 0, transparent 55%),
                radial-gradient(circle at 100% 0, #FFA451 0, transparent 55%),
                #FFFFFF;
            border-bottom: 3px solid #29B6F6;
            overflow: hidden;
        }

        /* GROS CERCLE COLORE DERRI√àRE LE TITRE */
        .header::before {
            content: '';
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 260px;
            height: 260px;
            background: radial-gradient(circle, #B2F2E6 0, transparent 65%);
            opacity: 0.6;
            z-index: 0;
        }

        /* PETITES FORMES PUZZLE EN HAUT DROIT */
        .header::after {
            content: '';
            position: absolute;
            top: 18px;
            right: 32px;
            width: 90px;
            height: 90px;
            background:
                radial-gradient(circle at 25% 25%, #D72638 0 30%, transparent 31%),
                radial-gradient(circle at 75% 45%, #29B6F6 0 28%, transparent 29%),
                radial-gradient(circle at 55% 80%, #FFCC00 0 26%, transparent 27%);
            opacity: 0.9;
            z-index: 0;
        }

        .logo-container,
        .logo-left {
            position: absolute;
            top: 20px;
            z-index: 2;
            background: #FFFFFF;
            border-radius: 999px;
            padding: 6px 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.08);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-container {
            right: 28px;
            width: 130px;
            height: 56px;
        }

        .logo-left {
            left: 28px;
            width: 150px;
            height: 42px;
        }

        .logo-container img,
        .logo-left img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header h1 {
            margin: 50px 0 8px;
            font-size: 2.4rem;
            font-weight: 900;
            font-family: 'Baloo', 'Fredoka', 'Nunito', 'Montserrat', sans-serif;
            letter-spacing: 1px;
            color: #D72638;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .header p {
            margin: 0;
            font-size: 1.05rem;
            font-weight: 600;
            color: #444444;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .content {
            padding: 32px 40px 40px;
            position: relative;
            z-index: 1;
            background:
                radial-gradient(circle at 0 100%, #FDF6E3 0, transparent 60%),
                #FFFFFF;
        }

        /* INTRO */
        .intro-section {
            text-align: center;
            margin-bottom: 24px;
        }

        .intro-section h2 {
            font-size: 1.9rem;
            font-weight: 800;
            font-family: 'Baloo', 'Fredoka', 'Nunito', 'Montserrat', sans-serif;
            color: #D72638;
            margin-bottom: 12px;
        }

        .intro-section h2::after {
            content: '';
            display: block;
            margin: 10px auto 0;
            width: 90px;
            height: 4px;
            border-radius: 999px;
            background: linear-gradient(90deg, #D72638, #29B6F6, #FFCC00);
        }

        .intro-section p {
            margin: 8px 0 0;
            color: #555555;
            font-size: 0.98rem;
        }

        /* ENCART EXPLICATION */
        .content > div[style*="Objectif"] { /* on laisse ton contenu inline intact, mais on am√©liore globalement par classes */
        }

        .step {
            display: none;
        }

        .step.active {
            display: block;
        }

        .form-group {
            margin: 20px 0 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 700;
            color: #333333;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border-radius: 999px;
            border: 2px solid #B2F2E6;
            font-size: 0.95rem;
            background: #FFFFFF;
            color: #111111;
            transition: all 0.2s ease;
        }

        .form-group input::placeholder {
            color: #999999;
        }

        .form-group input:focus {
            outline: none;
            border-color: #29B6F6;
            box-shadow: 0 0 0 3px rgba(41,182,246,0.25);
        }

        /* DOMAINE / QUESTIONS */
        .domain-section {
            background: #FFFFFF;
            border-radius: 20px;
            border: 1px solid #E5F2FC;
            padding: 22px 22px 18px;
            margin-bottom: 24px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.04);
            position: relative;
            overflow: hidden;
        }

        .domain-section::before {
            content: '';
            position: absolute;
            top: -40px;
            right: -40px;
            width: 100px;
            height: 100px;
            background:
                radial-gradient(circle, #29B6F6 0, transparent 65%);
            opacity: 0.22;
        }

        .domain-section::after {
            content: '';
            position: absolute;
            bottom: -35px;
            left: -35px;
            width: 90px;
            height: 90px;
            background:
                radial-gradient(circle, #FFCC00 0, transparent 65%);
            opacity: 0.18;
        }

        .domain-title {
            font-size: 1.25rem;
            font-weight: 800;
            font-family: 'Baloo', 'Fredoka', 'Nunito', 'Montserrat', sans-serif;
            color: #D72638;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .domain-icon {
            font-size: 1.4rem;
        }

        .domain-objective {
            background: #FFF7E1;
            border-radius: 12px;
            padding: 10px 12px;
            font-size: 0.9rem;
            color: #5A4C20;
            margin-bottom: 18px;
            border-left: 4px solid #FFCC00;
        }

        .question {
            margin-bottom: 18px;
        }

        .question-text {
            font-size: 0.98rem;
            font-weight: 500;
            color: #333333;
            margin-bottom: 10px;
        }

        /* √âCHELLE DE R√âPONSE */
        .rating-scale {
            display: grid;
            grid-template-columns: repeat(4, minmax(0, 1fr));
            gap: 10px;
        }

        .rating-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 10px 8px;
            border-radius: 14px;
            border: 2px solid transparent;
            background: #F8FAFC;
            transition: all 0.2s ease;
        }

        .rating-option input[type="radio"] {
            margin: 0;
            transform: scale(1.15);
            accent-color: #29B6F6;
        }

        .rating-option .rating-label {
            font-size: 0.8rem;
            text-align: center;
            font-weight: 600;
            color: #444444;
        }

        .rating-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.06);
        }

        /* Couleurs par niveau (LS4YOU-ish) */
        .rating-option[data-value="1"] {
            background: #FFE5E8;
            border-color: #F7A8B3;
        }

        .rating-option[data-value="2"] {
            background: #FFF5CC;
            border-color: #FFDC73;
        }

        .rating-option[data-value="3"] {
            background: #E1FFF3;
            border-color: #7DE3B8;
        }

        .rating-option[data-value="4"] {
            background: #E3F4FF;
            border-color: #7DCBFF;
        }

        .rating-option:has(input[type="radio"]:checked) {
            transform: translateY(-3px);
            box-shadow: 0 8px 18px rgba(0,0,0,0.09);
        }

        .rating-option[data-value="1"]:has(input[type="radio"]:checked) {
            background: #FDD2DA;
            border-color: #D72638;
        }

        .rating-option[data-value="2"]:has(input[type="radio"]:checked) {
            background: #FFE9A6;
            border-color: #FFCC00;
        }

        .rating-option[data-value="3"]:has(input[type="radio"]:checked) {
            background: #C6F7E2;
            border-color: #10B981;
        }

        .rating-option[data-value="4"]:has(input[type="radio"]:checked) {
            background: #CFEAFF;
            border-color: #29B6F6;
        }

        .rating-option:has(input[type="radio"]:checked) .rating-label {
            color: #111111;
        }

        /* BOUTONS */
        .btn {
            background: #D72638;
            color: #FFFFFF;
            border: none;
            padding: 13px 26px;
            border-radius: 999px;
            font-size: 0.95rem;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn:hover {
            background: #B61F30;
            box-shadow: 0 8px 20px rgba(183,31,48,0.32);
            transform: translateY(-1px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-secondary {
            background: #29B6F6;
        }

        .btn-secondary:hover {
            background: #1694CC;
            box-shadow: 0 8px 20px rgba(22,148,204,0.3);
        }

        /* PROGRESS BAR */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #F1F5F9;
            border-radius: 999px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #D72638, #FFA451, #29B6F6);
            width: 0%;
            transition: width 0.4s ease;
        }

        /* CARTES R√âSULTATS */
        .results-section h2 {
            font-size: 1.7rem;
            font-weight: 800;
            color: #D72638;
            text-align: center;
            margin-bottom: 18px;
        }

        .radar-container {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            justify-content: space-between;
            margin: 18px 0;
        }

        .chart-container {
            background: #FFFFFF;
            border-radius: 18px;
            border: 1px solid #E5F2FC;
            padding: 18px;
            flex: 1 1 300px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.04);
        }

        .chart-title {
            font-weight: 700;
            font-size: 1rem;
            color: #111111;
            margin-bottom: 10px;
        }

        .life-skills-grid {
            display: grid;
            grid-template-columns: repeat(2, minmax(0,1fr));
            gap: 12px;
        }

        .skill-card {
            background: #F9FAFB;
            border-radius: 14px;
            padding: 14px;
            position: relative;
        }

        .skill-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 4px;
            width: 100%;
            border-radius: 999px 999px 0 0;
            background: linear-gradient(90deg, #D72638, #29B6F6, #FFCC00);
        }

        .skill-name {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333333;
            margin-bottom: 6px;
        }

        .skill-score {
            font-size: 1.6rem;
            font-weight: 800;
            color: #29B6F6;
        }

        .domain-bars {
            display: grid;
            grid-template-columns: repeat(auto-fit,minmax(220px,1fr));
            gap: 10px;
        }

        .domain-bar {
            background: #F9FAFB;
            border-radius: 12px;
            padding: 10px 12px;
        }

        .domain-bar-name {
            font-size: 0.86rem;
            font-weight: 700;
            color: #444444;
            margin-bottom: 6px;
        }

        .bar-container {
            width: 100%;
            height: 22px;
            border-radius: 999px;
            background: #E5F2FC;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #D72638, #FFA451, #29B6F6);
            color: #FFFFFF;
            font-size: 0.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .priority-areas {
            background: #FFF7E1;
            border-radius: 18px;
            border: 1px solid #FFCC00;
            padding: 18px;
            margin: 18px 0;
        }

        .priority-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #B46200;
            margin-bottom: 8px;
        }

        .action-plan {
            background: #E9FBF5;
            border-radius: 18px;
            border: 1px solid #10B981;
            padding: 18px;
            margin: 18px 0;
        }

        .action-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #036749;
            margin-bottom: 8px;
        }

        .saved-assessments {
            background: #F1F5F9;
            border-radius: 16px;
            padding: 14px;
            margin-top: 18px;
        }

        .assessment-item {
            background: #FFFFFF;
            border-radius: 10px;
            padding: 10px 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            border: 1px solid #E5E7EB;
        }

        .assessment-name {
            font-weight: 600;
            color: #111111;
            margin-bottom: 3px;
        }

        .assessment-date {
            font-size: 0.8rem;
            color: #6B7280;
        }

        .btn-small {
            padding: 8px 14px;
            font-size: 0.8rem;
        }

        /* ACTIVIT√âS */
        .activity-card {
            background: #FFFFFF;
            border-radius: 18px;
            border-left: 5px solid #29B6F6;
            padding: 18px 18px 16px;
            margin-bottom: 16px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.05);
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .activity-icon {
            font-size: 1.8rem;
        }

        .activity-title {
            margin: 0;
            font-size: 1.05rem;
            font-weight: 700;
            color: #111111;
        }

        .activity-subtitle {
            margin: 2px 0 0;
            font-size: 0.85rem;
            color: #6B7280;
        }

        .activity-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 8px 0 10px;
        }

        .meta-item {
            background: #F3F4F6;
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #4B5563;
        }

        .skills-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin: 8px 0;
        }

        .skill-tag {
            background: #EDE9FE;
            color: #5B21B6;
            border-radius: 999px;
            padding: 4px 9px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .activity-steps h4 {
            margin: 8px 0;
            font-size: 0.95rem;
            color: #111111;
        }

        .step-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .step-item {
            background: #F9FAFB;
            border-radius: 10px;
            padding: 8px 10px;
            font-size: 0.88rem;
            margin-bottom: 6px;
            border-left: 3px solid #29B6F6;
        }

        .transfer-note {
            background: #E0F2FE;
            border-radius: 12px;
            padding: 10px 12px;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .transfer-title {
            font-weight: 600;
            color: #0F4C81;
            margin-bottom: 4px;
        }

        /* LOADING */
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
        }

        .spinner {
            border: 4px solid #E5E7EB;
            border-top: 4px solid #29B6F6;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* MESSAGES INLINE */
        .inline-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 14px;
            border-radius: 999px;
            color: #FFFFFF;
            font-size: 0.88rem;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(0,0,0,0.16);
            z-index: 1000;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                border-radius: 18px;
            }

            .header {
                padding: 28px 18px 20px;
            }

            .logo-container,
            .logo-left {
                position: static;
                margin: 0 auto 10px;
            }

            .header h1 {
                font-size: 1.8rem;
                margin-top: 12px;
            }

            .content {
                padding: 22px 16px 24px;
            }

            .rating-scale {
                grid-template-columns: repeat(2,minmax(0,1fr));
            }

            .btn,
            .btn-secondary {
                width: 100%;
                justify-content: center;
                margin-bottom: 8px;
            }

            .radar-container {
                flex-direction: column;
            }

            .life-skills-grid {
                grid-template-columns: 1fr;
            }

            .domain-bars {
                grid-template-columns: 1fr;
            }

            .inline-message {
                left: 10px;
                right: 10px;
                top: 10px;
                border-radius: 12px;
            }

            .activity-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <div class="logo-left"><img src="https://static.wixstatic.com/media/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif/v1/fill/w_313,h_84,al_c,lg_1,q_80,enc_avif,quality_auto/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif" alt="Mission Locale Logo" onerror="this.src=''; this.alt='Logo Mission Locale indisponible'; this.style.display='none';">
    </div>
    <div class="logo-container"><img src="https://static.wixstatic.com/media/dd5dab_31e98305be67485d92cdb56f82c0e03f~mv2.png/v1/fill/w_560,h_224,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/LS4YOU_Logo.png" alt="LS4YOU Logo" onerror="this.src=''; this.alt='Logo LS4YOU indisponible'; this.style.display='none';">
    </div>
    <h1 id="toolTitle">Diagnostic Life Skills</h1>
    <p id="organizationName">Mission Locale Pays Basque</p>
   </div>
   <div class="content"><!-- √âtape 1: Accueil et assessments sauvegard√©s -->
    <div class="step active" id="step-welcome">
     <div class="intro-section">
      <h2>üéØ Bienvenue dans votre diagnostic Life Skills</h2>
      <p id="instructionsText">Ce diagnostic vous permettra d'identifier vos forces et vos besoins dans 11 domaines essentiels √† votre insertion professionnelle et sociale.</p>
      <div style="background:#FFF7E1;border:1px solid #FFCC00;border-radius:18px;padding:18px;margin:18px 0;text-align:left;">
       <h3 style="color:#B46200;margin-bottom:10px;font-size:1rem;text-transform:uppercase;letter-spacing:0.5px;">üéÆ Comment √ßa marche ?</h3>
       <p style="color:#4B5563;margin-bottom:10px;line-height:1.5;">Pour chaque affirmation, choisissez l'option qui vous correspond le mieux :</p>
       <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:12px 0;">
        <div style="background:#FFE5E8;padding:10px;border-radius:12px;text-align:center;border:1px solid #F7A8B3;"><strong style="color:#B3263A;">üî¥ Zone de d√©fi</strong><br><small style="color:#7F1D1D;">C'est difficile pour moi</small>
        </div>
        <div style="background:#FFF5CC;padding:10px;border-radius:12px;text-align:center;border:1px solid #FFDC73;"><strong style="color:#C68A00;">üü° En progression</strong><br><small style="color:#854D0E;">J'y arrive parfois</small>
        </div>
        <div style="background:#E1FFF3;padding:10px;border-radius:12px;text-align:center;border:1px solid #7DE3B8;"><strong style="color:#047857;">üü¢ Plut√¥t au point</strong><br><small style="color:#047857;">Je me d√©brouille bien</small>
        </div>
        <div style="background:#E3F4FF;padding:10px;border-radius:12px;text-align:center;border:1px solid #7DCBFF;"><strong style="color:#0B63A4;">‚≠ê C'est mon fort</strong><br><small style="color:#0B63A4;">Je ma√Ætrise vraiment</small>
        </div>
       </div>
       <p style="color:#4B5563;margin-top:10px;font-style:italic;">üí° Soyez honn√™te avec vous-m√™me, c'est le meilleur moyen d'identifier vos vraies forces et vos axes de progression !</p>
      </div>
     </div>
     <div class="saved-assessments" id="savedAssessments" style="display: none;">
      <h3 style="margin:0 0 8px;font-size:1rem;color:#111111;">üìã Diagnostics pr√©c√©dents</h3>
      <div id="assessmentsList"></div>
     </div>
     <div class="form-group"><label for="participantName">Votre pr√©nom et nom :</label> <input type="text" id="participantName" placeholder="Ex: Marie Dupont" required>
     </div><button class="btn" onclick="startAssessment()">Commencer le diagnostic</button>
    </div>
    <!-- √âtape 2: Questions par domaine -->
    <div class="step" id="step-assessment">
     <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
     </div>
     <div id="questionsContainer"></div>
     <div style="text-align: center; margin-top: 24px;"><button class="btn btn-secondary" onclick="previousDomain()" id="prevBtn" style="display: none;">Pr√©c√©dent</button> <button class="btn" onclick="nextDomain()" id="nextBtn">Suivant</button>
     </div>
    </div>
    <!-- √âtape 3: R√©sultats -->
    <div class="step" id="step-results">
     <div class="results-section">
      <h2>üìä Vos r√©sultats Life Skills</h2>
      <div class="radar-container">
       <div class="chart-container">
        <div class="chart-title">
         üß† Comp√©tences Life Skills
        </div>
        <div class="life-skills-grid" id="lifeSkillsResults"></div>
       </div>
       <div class="chart-container">
        <div class="chart-title">
         üìà Domaines d'insertion
        </div>
        <div class="domain-bars" id="domainResults"></div>
       </div>
      </div>
      <div class="priority-areas" id="priorityAreas"></div>
      <div class="action-plan">
       <div class="action-title">
        üí¨ Questions pour le debrief avec votre conseiller
       </div>
       <div id="debriefQuestions">
        <p><strong>Ce que tu fais d√©j√† bien :</strong></p>
        <p><em>Quels sont tes points forts selon ces r√©sultats ? Dans quels domaines te sens-tu le plus √† l'aise ?</em></p>
        <p><strong>Ce qui te bloque :</strong></p>
        <p><em>Quels domaines te posent le plus de difficult√©s ? Qu'est-ce qui t'emp√™che d'avancer dans ces domaines ?</em></p>
        <p><strong>Ce qui pourrait t'aider maintenant :</strong></p>
        <p><em>De quoi aurais-tu besoin pour progresser ? Quelles actions concr√®tes pourrais-tu mettre en place ?</em></p>
       </div>
      </div>
      <div class="action-plan" id="actionPlan"></div>
      <div style="text-align: center; margin-top: 24px;"><button class="btn btn-secondary" onclick="restartAssessment()">Nouveau diagnostic</button> <button class="btn" onclick="saveResults()" id="saveBtn">Sauvegarder les r√©sultats</button> <button class="btn" onclick="showActivities()" style="margin-left: 8px; background: #10b981;">Voir les activit√©s</button>
      </div>
     </div>
    </div>
    <!-- √âtape 4: Activit√©s par domaine -->
    <div class="step" id="step-activities">
     <div class="results-section">
      <h2>üéØ Activit√©s adapt√©es √† vos besoins</h2>
      <p>D√©couvrez des activit√©s pratiques pour d√©velopper vos comp√©tences dans les domaines prioritaires.</p>
      <div id="activitiesContainer"></div>
      <div style="text-align: center; margin-top: 24px;"><button class="btn btn-secondary" onclick="showStep('step-results')">Retour aux r√©sultats</button> <button class="btn" onclick="restartAssessment()">Nouveau diagnostic</button>
      </div>
     </div>
    </div>
    <div class="loading" id="loading">
     <div class="spinner"></div>
     <p>Sauvegarde en cours...</p>
    </div>
   </div>
  </div>

  <!-- JS INCHANG√â (FONCTIONNEL) -->
  <script>
        // (Tout le JS d'origine inchang√©)
        // Configuration des domaines et questions adapt√©es aux jeunes NEET
        const domains = [
            {
                name: "Emploi",
                icon: "üíº",
                objective: "√âvaluer la capacit√© √† se pr√©senter, comprendre les codes professionnels, demander de l'aide, se projeter dans le travail",
                questions: [
                    "M√™me sans dipl√¥me, je sais mettre en avant mes qualit√©s",
                    "Face √† un employeur, j'arrive √† expliquer pourquoi il devrait me recruter",
                    "Quand on me donne une mission, je comprends ce qu'on attend de moi",
                    "Si j'ai des difficult√©s au travail, j'ose demander de l'aide",
                    "Il y a au moins un type de m√©tier o√π je me projette"
                ],
                lifeSkills: {
                    "Personnalit√©": "motivation / choix / forces",
                    "Valorisation": "parler de soi / pitch",
                    "Bien-√™tre": "stress entretien, pression",
                    "Ressources": "salaire / contrats"
                }
            },
            {
                name: "Formation",
                icon: "üìö",
                objective: "√âvaluer concentration, pers√©v√©rance, rapport √† l'erreur, capacit√© √† poser des questions",
                questions: [
                    "M√™me si l'√©cole √©tait difficile, je peux me concentrer sur ce qui m'int√©resse",
                    "Je peux suivre une formation sur plusieurs jours sans abandonner",
                    "En cours, j'ose poser des questions si je ne comprends pas",
                    "Les examens me stressent mais ne me paralysent pas",
                    "Si une formation peut m'aider, je suis pr√™t¬∑e √† faire des efforts"
                ],
                lifeSkills: {
                    "Personnalit√©": "pers√©v√©rance / rapport √† l'effort",
                    "Valorisation": "reconnaissance des progr√®s",
                    "Bien-√™tre": "charge mentale / stress scolaire",
                    "Ressources": "aides formation"
                }
            },
            {
                name: "Orientation",
                icon: "üß≠",
                objective: "√âvaluer int√©r√™ts, valeurs, forces, id√©es d'avenir, flexibilit√©",
                questions: [
                    "J'ai au moins une id√©e de ce que je pourrais faire plus tard",
                    "Je sais ce qui me pla√Æt dans la vie, m√™me si ce n'est pas scolaire",
                    "Il y a des domaines o√π je me d√©brouille mieux que d'autres",
                    "J'ai le droit de me tromper et de changer de voie",
                    "M√™me dans l'incertitude, je vois quelques pistes pour avancer"
                ],
                lifeSkills: {
                    "Personnalit√©": "int√©r√™ts / valeurs",
                    "Valorisation": "confiance / identit√©",
                    "Bien-√™tre": "anxi√©t√© orientation",
                    "Ressources": "r√©alit√©s m√©tiers / contraintes"
                }
            },
            {
                name: "Mobilit√©",
                icon: "üöó",
                objective: "Observer organisation, autonomie, acc√®s aux transports, gestion stress d√©placements",
                questions: [
                    "Quand j'ai un rendez-vous important, j'arrive √† m'y rendre",
                    "J'ai au moins un moyen de me d√©placer (m√™me si c'est compliqu√©)",
                    "Si je dois aller quelque part de nouveau, je peux demander comment faire",
                    "Parfois les transports me posent des probl√®mes (argent, stress, organisation)",
                    "Je sais vers qui me tourner si j'ai un probl√®me de transport"
                ],
                lifeSkills: {
                    "Personnalit√©": "autonomie",
                    "Valorisation": "fiabilit√© (√™tre √† l'heure)",
                    "Bien-√™tre": "anxi√©t√© trajets",
                    "Ressources": "permis / co√ªt / r√©seau"
                }
            },
            {
                name: "Sant√©",
                icon: "‚ù§Ô∏è",
                objective: "√âvaluer √©nergie, stress, strat√©gies de r√©gulation, rep√©rage des signaux",
                questions: [
                    "En g√©n√©ral, j'ai l'√©nergie pour faire ce que j'ai √† faire",
                    "Je sens quand √ßa ne va pas dans ma t√™te ou mon corps",
                    "J'ai ma fa√ßon √† moi de d√©compresser quand √ßa va mal",
                    "Il y a au moins une personne √† qui je peux dire que √ßa ne va pas",
                    "Ma sant√© (physique ou mentale) me complique parfois les choses"
                ],
                lifeSkills: {
                    "Personnalit√©": "limites personnelles",
                    "Valorisation": "se sentir digne de soin",
                    "Bien-√™tre": "c≈ìur du domaine",
                    "Ressources": "acc√®s aux soins"
                }
            },
            {
                name: "Logement",
                icon: "üè°",
                objective: "Comprendre l'impact du logement sur le quotidien, la s√©curit√©, la capacit√© √† avancer",
                questions: [
                    "J'ai un endroit o√π dormir en s√©curit√©",
                    "Chez moi, je peux me reposer tranquillement quand j'en ai besoin",
                    "Mon logement me permet d'aller √† mes rendez-vous et activit√©s",
                    "Si ma situation de logement changeait, je saurais qui contacter"
                ],
                lifeSkills: {
                    "Personnalit√©": "estime ‚Äì je m√©rite un lieu stable",
                    "Valorisation": "capacit√© √† demander un accompagnement",
                    "Bien-√™tre": "sommeil / s√©curit√©",
                    "Ressources": "logement / dispositifs"
                }
            },
            {
                name: "Citoyennet√©",
                icon: "üî¥",
                objective: "√âvaluer l'expression, la participation, la capacit√© √† demander du soutien",
                questions: [
                    "Dans un petit groupe bienveillant, j'arrive √† dire ce que je pense",
                    "Il y a au moins un adulte qui m'√©coute vraiment",
                    "Je sais que j'ai des droits, m√™me si je ne connais pas tout",
                    "S'il y avait un projet qui m'int√©resse, je pourrais m'y investir"
                ],
                lifeSkills: {
                    "Personnalit√©": "sentiment d'agir",
                    "Valorisation": "place dans les groupes",
                    "Bien-√™tre": "environnement sain ou toxique",
                    "Ressources": "droits / participation"
                }
            },
            {
                name: "Finances",
                icon: "üí∂",
                objective: "Explorer compr√©hension du budget, aides, stress financier",
                questions: [
                    "Je sais combien j'ai d'argent par mois (m√™me si ce n'est pas beaucoup)",
                    "Je vois quand je vais avoir des difficult√©s financi√®res",
                    "Je peux parler d'argent avec quelqu'un sans avoir honte",
                    "Je sais qu'il y a des aides possibles (m√™me si je ne connais pas tout)",
                    "Le manque d'argent m'emp√™che parfois de faire certaines choses"
                ],
                lifeSkills: {
                    "Personnalit√©": "prise de d√©cision / priorisation",
                    "Valorisation": "sortir de la honte financi√®re",
                    "Bien-√™tre": "stress budget",
                    "Ressources": "aides / gestion"
                }
            },
            {
                name: "Loisirs",
                icon: "üé®",
                objective: "Rep√©rer activit√©s qui soutiennent l'√©quilibre et la motivation",
                questions: [
                    "J'ai au moins une activit√© que j'aime faire qui me fait du bien",
                    "Je prends du temps pour moi dans la semaine",
                    "De temps en temps, je teste de nouvelles activit√©s ou endroits",
                    "Mes activit√©s m'aident √† aller mieux ou √† avoir confiance",
                    "Je vois un lien entre ce que j'aime et ce que je pourrais faire plus tard"
                ],
                lifeSkills: {
                    "Personnalit√©": "go√ªts, talents",
                    "Valorisation": "parler de ses passions comme forces",
                    "Bien-√™tre": "r√©gulation √©motionnelle",
                    "Ressources": "acc√®s activit√©"
                }
            },
            {
                name: "Num√©rique",
                icon: "üì±",
                objective: "√âvaluer acc√®s aux outils, comp√©tences num√©riques essentielles, s√©curit√© en ligne",
                questions: [
                    "J'ai acc√®s √† un t√©l√©phone et internet quand j'en ai besoin",
                    "Je peux me d√©brouiller pour faire des d√©marches en ligne",
                    "Je sais chercher des informations utiles sur internet",
                    "Je fais attention √† ce que je poste sur les r√©seaux sociaux",
                    "Si j'ai des difficult√©s avec le num√©rique, je sais √† qui demander"
                ],
                lifeSkills: {
                    "Personnalit√©": "limites / choix / contr√¥le",
                    "Valorisation": "pr√©sence en ligne pro",
                    "Bien-√™tre": "gestion r√©seaux / pression sociale",
                    "Ressources": "acc√®s num√©rique / d√©marches"
                }
            },
            {
                name: "Mode de vie",
                icon: "‚è≥",
                objective: "Comprendre comment le rythme quotidien impacte projet, √©nergie et disponibilit√©",
                questions: [
                    "Mes horaires de sommeil me permettent de tenir le coup",
                    "Quand c'est important, j'arrive √† √™tre √† l'heure",
                    "Je note mes rendez-vous importants pour ne pas les oublier",
                    "J'arrive √† jongler entre mes diff√©rentes activit√©s",
                    "Je sais quand j'ai besoin de faire une pause et je le fais"
                ],
                lifeSkills: {
                    "Personnalit√©": "organisation personnelle / limites",
                    "Valorisation": "fiabilit√© / ponctualit√©",
                    "Bien-√™tre": "√©quilibre vie / r√©cup√©ration",
                    "Ressources": "gestion du temps / outils"
                }
            }
        ];

        const lifeSkillsMapping = {
            "Personnalit√©": ["Orientation", "Sant√©", "Mode de vie"],
            "Valorisation": ["Emploi", "Formation", "Citoyennet√©"],
            "Bien-√™tre": ["Sant√©", "Logement", "Loisirs"],
            "Ressources": ["Mobilit√©", "Finances", "Num√©rique"]
        };

        const domainActivities = {
            "Emploi": [
                {
                    title: "Mon Pitch en 30 secondes",
                    objective: "Apprendre √† parler de soi simplement",
                    skills: ["Valorisation", "Personnalit√©"],
                    duration: "45 min",
                    format: "Individuel + vid√©o",
                    steps: [
                        "Compl√©ter 3 phrases : 'Je suis...', 'On me reconna√Æt souvent pour...', 'Je suis dou√©¬∑e pour...'",
                        "Construire un pitch simple et authentique",
                        "Enregistrer une vid√©o de pr√©sentation",
                        "Recevoir des retours bienveillants du groupe"
                    ],
                    transfer: "Utile pour les entretiens d'embauche et pr√©sentations professionnelles"
                }
            ],
            "Formation": [
                {
                    title: "Le Feedback qui fait grandir",
                    objective: "Apprendre √† recevoir et demander un feedback",
                    skills: ["Valorisation", "Bien-√™tre"],
                    duration: "1h",
                    format: "Collectif + bin√¥mes",
                    steps: [
                        "Mini-jeu : identifier 'bon feedback / mauvais feedback'",
                        "Simulations en bin√¥me pour pratiquer",
                        "√âlaboration d'une action 'je progresse dans...'",
                        "Debrief collectif sur les apprentissages"
                    ],
                    transfer: "Am√©liore la capacit√© d'apprentissage et l'adaptation en formation"
                }
            ],
            "Orientation": [
                {
                    title: "Mon Mini Magazine de Vie (Zine)",
                    objective: "Faire √©merger centres d'int√©r√™t et valeurs",
                    skills: ["Personnalit√©", "Valorisation"],
                    duration: "1h30",
                    format: "Cr√©atif individuel",
                    steps: [
                        "D√©couper/coller des images refl√©tant la vie souhait√©e",
                        "Structurer en 4 pages : moi / mes forces / ce que j'aime / o√π je veux aller",
                        "Finaliser son magazine personnel",
                        "Pr√©sentation optionnelle au groupe"
                    ],
                    transfer: "Clarifie le projet de vie et facilite les choix d'orientation"
                }
            ],
            "Mobilit√©": [
                {
                    title: "Moi en D√©placement : choix & cons√©quences",
                    objective: "Comprendre l'impact de la mobilit√©",
                    skills: ["Ressources", "Organisation"],
                    duration: "45 min",
                    format: "Simulation pratique",
                    steps: [
                        "Choisir un sc√©nario : 'aller au travail', 'aller en formation', 'aller voir quelqu'un important'",
                        "Identifier les solutions possibles de transport",
                        "Calculer le co√ªt de chaque solution",
                        "Analyser les difficult√©s potentielles",
                        "D√©finir sa prochaine √©tape mobilit√© concr√®te"
                    ],
                    transfer: "Facilite l'acc√®s √† l'emploi et √† la formation en anticipant les contraintes"
                }
            ],
            "Sant√©": [
                {
                    title: "Mon Stressom√®tre",
                    objective: "Rep√©rer signes de stress + cr√©er un plan d'apaisement",
                    skills: ["Bien-√™tre", "Personnalit√©"],
                    duration: "1h",
                    format: "Auto-√©valuation + cr√©ation d'outils",
                    steps: [
                        "Auto-√©valuation de son niveau de stress actuel",
                        "Identifier son profil : zen / pressur√© / en alerte",
                        "Rep√©rer ses signaux personnels de stress",
                        "√âlaborer son 'kit apaisement' personnalis√©",
                        "Tester une technique d'apaisement imm√©diatement"
                    ],
                    transfer: "Am√©liore la performance en entretien et la gestion du quotidien"
                }
            ],
            "Logement": [
                {
                    title: "Mon Budget Logement",
                    objective: "Visualiser le co√ªt de la vie autonome",
                    skills: ["Ressources"],
                    duration: "45 min",
                    format: "Calcul pratique",
                    steps: [
                        "Rechercher et calculer le co√ªt d'un logement r√©el dans sa zone",
                        "Lister toutes les charges associ√©es (√©lectricit√©, internet, assurance...)",
                        "Comparer le co√ªt total avec ses ressources actuelles/futures",
                        "Identifier les ajustements possibles (colocation, aides, zone g√©ographique)",
                        "D√©finir un plan d'action logement r√©aliste"
                    ],
                    transfer: "Pr√©pare l'autonomie et s√©curise les conditions de vie pour l'insertion"
                }
            ],
            "Citoyennet√©": [
                {
                    title: "Ma Carte de Soutien",
                    objective: "Identifier son r√©seau d'aide",
                    skills: ["Valorisation", "Personnalit√©"],
                    duration: "1h",
                    format: "Cartographie + action",
                    steps: [
                        "Dessiner son r√©seau actuel (famille, amis, professionnels, institutions)",
                        "Ajouter les personnes positives et ressources",
                        "Identifier ses besoins d'aide actuels et futurs",
                        "Rep√©rer les manques dans son r√©seau",
                        "Action concr√®te : contacter 1 personne ressource cette semaine"
                    ],
                    transfer: "Facilite l'acc√®s aux opportunit√©s et au soutien dans l'insertion"
                }
            ],
            "Finances": [
                {
                    title: "Du Brut au Net",
                    objective: "Comprendre salaire + g√©rer budget",
                    skills: ["Ressources"],
                    duration: "1h",
                    format: "Simulation + planification",
                    steps: [
                        "Simuler un salaire net √† partir d'un salaire brut (charges sociales, imp√¥ts)",
                        "Lister toutes les d√©penses essentielles mensuelles",
                        "Calculer le reste √† vivre apr√®s les charges obligatoires",
                        "Construire un budget √©quilibr√© et r√©aliste",
                        "Identifier les marges de man≈ìuvre et d'√©pargne"
                    ],
                    transfer: "Pr√©pare √† la n√©gociation salariale et √† l'autonomie financi√®re"
                }
            ],
            "Loisirs": [
                {
                    title: "Mes Boosters de Bien-√ätre",
                    objective: "Identifier activit√©s qui donnent de l'√©nergie",
                    skills: ["Bien-√™tre"],
                    duration: "30 min",
                    format: "R√©flexion + planification",
                    steps: [
                        "Lister 'Ce qui me fait du bien' (activit√©s, lieux, personnes)",
                        "S√©lectionner 3 activit√©s faciles √† mettre en place",
                        "V√©rifier la faisabilit√© (co√ªt, temps, accessibilit√©)",
                        "Inscrire ces activit√©s dans un planning hebdomadaire",
                        "S'engager sur une premi√®re action dans les 48h"
                    ],
                    transfer: "Am√©liore l'√©quilibre vie pro/perso et maintient la motivation"
                }
            ],
            "Num√©rique": [
                {
                    title: "Mon Image en Ligne",
                    objective: "Ma√Ætriser identit√© num√©rique",
                    skills: ["Valorisation", "Ressources"],
                    duration: "1h",
                    format: "Audit + cr√©ation",
                    steps: [
                        "Google test : rechercher son nom et voir ce qui appara√Æt",
                        "Audit de ses profils sur les r√©seaux sociaux",
                        "Nettoyage rapide (photos inappropri√©es, statuts probl√©matiques)",
                        "Cr√©ation ou am√©lioration d'un profil professionnel simple",
                        "D√©finir sa strat√©gie de pr√©sence en ligne"
                    ],
                    transfer: "√âvite les √©cueils en recrutement et valorise son profil professionnel"
                }
            ],
            "Mode de vie": [
                {
                    title: "Ma Routine Qui Me Fait du Bien",
                    objective: "Cr√©er un mode de vie stable",
                    skills: ["Personnalit√©", "Bien-√™tre"],
                    duration: "45 min",
                    format: "Analyse + construction",
                    steps: [
                        "Identifier ses habitudes actuelles positives et n√©gatives",
                        "Choisir 1 changement utile et r√©alisable",
                        "Construire un plan quotidien simple et stable",
                        "D√©finir des indicateurs de r√©ussite",
                        "Pr√©voir les obstacles et solutions de contournement"
                    ],
                    transfer: "Am√©liore la r√©gularit√© et l'efficacit√© dans les d√©marches d'insertion"
                }
            ]
        };

        let currentDomain = 0;
        let responses = {};
        let currentRecordCount = 0;
        let allAssessments = [];

        const defaultConfig = {
            tool_title: "Diagnostic Life Skills",
            organization_name: "Mission Locale Edition",
            instructions_text: "Ce diagnostic vous permettra d'identifier vos forces et vos besoins dans 11 domaines essentiels √† votre insertion professionnelle et sociale."
        };

        const dataHandler = {
            onDataChanged(data) {
                allAssessments = data;
                currentRecordCount = data.length;
                displaySavedAssessments();
            }
        };

        async function initializeApp() {
            if (window.dataSdk) {
                const initResult = await window.dataSdk.init(dataHandler);
                if (!initResult.isOk) {
                    console.error("Erreur d'initialisation du SDK de donn√©es");
                }
            }

            if (window.elementSdk) {
                await window.elementSdk.init({
                    defaultConfig,
                    onConfigChange: async (config) => {
                        const toolTitle = config.tool_title || defaultConfig.tool_title;
                        const orgName = config.organization_name || defaultConfig.organization_name;
                        const instructions = config.instructions_text || defaultConfig.instructions_text;

                        document.getElementById('toolTitle').textContent = toolTitle;
                        document.getElementById('organizationName').textContent = orgName;
                        document.getElementById('instructionsText').textContent = instructions;
                    },
                    mapToCapabilities: (config) => ({
                        recolorables: [
                            {
                                get: () => config.primary_color || "#D72638",
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ primary_color: value });
                                    }
                                }
                            },
                            {
                                get: () => config.secondary_color || "#29B6F6",
                                set: (value) => {
                                    if (window.elementSdk) {
                                        window.elementSdk.setConfig({ secondary_color: value });
                                    }
                                }
                            }
                        ],
                        borderables: [],
                        fontEditable: {
                            get: () => config.font_family || "Montserrat",
                            set: (value) => {
                                if (window.elementSdk) {
                                    window.elementSdk.setConfig({ font_family: value });
                                }
                            }
                        },
                        fontSizeable: {
                            get: () => config.font_size || 16,
                            set: (value) => {
                                if (window.elementSdk) {
                                    window.elementSdk.setConfig({ font_size: value });
                                }
                            }
                        }
                    }),
                    mapToEditPanelValues: (config) => new Map([
                        ["tool_title", config.tool_title || defaultConfig.tool_title],
                        ["organization_name", config.organization_name || defaultConfig.organization_name],
                        ["instructions_text", config.instructions_text || defaultConfig.instructions_text]
                    ])
                });
            }
        }

        function displaySavedAssessments() {
            const container = document.getElementById('savedAssessments');
            const list = document.getElementById('assessmentsList');
            
            if (allAssessments.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            list.innerHTML = '';

            allAssessments.forEach(assessment => {
                const item = document.createElement('div');
                item.className = 'assessment-item';
                
                const date = new Date(assessment.assessment_date);
                const formattedDate = date.toLocaleDateString('fr-FR');
                
                item.innerHTML = `
                    <div class="assessment-info">
                        <div class="assessment-name">${assessment.participant_name}</div>
                        <div class="assessment-date">Diagnostic du ${formattedDate}</div>
                    </div>
                    <button class="btn btn-small" onclick="viewAssessment('${assessment.__backendId}')">
                        Voir les r√©sultats
                    </button>
                `;
                
                list.appendChild(item);
            });
        }

        function viewAssessment(assessmentId) {
            const assessment = allAssessments.find(a => a.__backendId === assessmentId);
            if (!assessment) return;

            responses = JSON.parse(assessment.domain_scores);
            showResults();
            showStep('step-results');
        }

        function startAssessment() {
            const name = document.getElementById('participantName').value.trim();
            if (!name) {
                showInlineMessage('Veuillez saisir votre nom pour commencer.', 'error');
                return;
            }

            currentDomain = 0;
            responses = {};
            generateQuestions();
            showStep('step-assessment');
            updateProgress();
        }

        function generateQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';

            domains.forEach((domain, domainIndex) => {
                const domainDiv = document.createElement('div');
                domainDiv.className = 'domain-section';
                domainDiv.id = `domain-${domainIndex}`;
                domainDiv.style.display = domainIndex === 0 ? 'block' : 'none';

                domainDiv.innerHTML = `
                    <div class="domain-title">
                        <span class="domain-icon">${domain.icon}</span>
                        ${domain.name}
                    </div>
                    <div class="domain-objective">
                        <strong>üéØ Objectif :</strong> ${domain.objective}
                    </div>
                `;

                domain.questions.forEach((question, questionIndex) => {
                    const questionDiv = document.createElement('div');
                    questionDiv.className = 'question';
                    
                    const questionId = `q_${domainIndex}_${questionIndex}`;
                    
                    questionDiv.innerHTML = `
                        <div class="question-text">${question}</div>
                        <div class="rating-scale">
                            ${[1,2,3,4].map(value => `
                                <label class="rating-option" data-value="${value}">
                                    <input type="radio" name="${questionId}" value="${value}" onchange="updateResponse('${questionId}', ${value})">
                                    <span class="rating-label">${getRatingLabel(value)}</span>
                                </label>
                            `).join('')}
                        </div>
                    `;
                    
                    domainDiv.appendChild(questionDiv);
                });

                container.appendChild(domainDiv);
            });
        }

        function getRatingLabel(value) {
            const labels = {
                1: "üî¥ Zone de d√©fi",
                2: "üü° En progression", 
                3: "üü¢ Plut√¥t au point",
                4: "‚≠ê C'est mon fort"
            };
            return labels[value];
        }

        function updateResponse(questionId, value) {
            responses[questionId] = value;
            updateNavigationButtons();
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.style.display = currentDomain > 0 ? 'inline-flex' : 'none';
            
            if (currentDomain === domains.length - 1) {
                const allAnswered = domains[currentDomain].questions.every((_, qIndex) => {
                    return responses[`q_${currentDomain}_${qIndex}`] !== undefined;
                });
                
                nextBtn.textContent = allAnswered ? 'Voir mes r√©sultats' : 'Terminer';
                nextBtn.disabled = !allAnswered;
            } else {
                nextBtn.textContent = 'Suivant';
                nextBtn.disabled = false;
            }
        }

        function nextDomain() {
            if (currentDomain < domains.length - 1) {
                const allAnswered = domains[currentDomain].questions.every((_, qIndex) => {
                    return responses[`q_${currentDomain}_${qIndex}`] !== undefined;
                });
                
                if (!allAnswered) {
                    showInlineMessage('Veuillez r√©pondre √† toutes les questions avant de continuer.', 'warning');
                    return;
                }
                
                document.getElementById(`domain-${currentDomain}`).style.display = 'none';
                currentDomain++;
                document.getElementById(`domain-${currentDomain}`).style.display = 'block';
                updateProgress();
                updateNavigationButtons();
            } else {
                showResults();
                showStep('step-results');
            }
        }

        function previousDomain() {
            if (currentDomain > 0) {
                document.getElementById(`domain-${currentDomain}`).style.display = 'none';
                currentDomain--;
                document.getElementById(`domain-${currentDomain}`).style.display = 'block';
                updateProgress();
                updateNavigationButtons();
            }
        }

        function updateProgress() {
            const progress = ((currentDomain + 1) / domains.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
        }

        function showResults() {
            const domainScores = {};
            domains.forEach((domain, domainIndex) => {
                const domainResponses = domain.questions.map((_, qIndex) => 
                    responses[`q_${domainIndex}_${qIndex}`] || 0
                );
                const average = domainResponses.reduce((a, b) => a + b, 0) / domainResponses.length;
                domainScores[domain.name] = Math.round((average / 4) * 100);
            });

            const lifeSkillsScores = {};
            Object.keys(lifeSkillsMapping).forEach(skill => {
                const relatedDomains = lifeSkillsMapping[skill];
                const scores = relatedDomains.map(domainName => domainScores[domainName]);
                const average = scores.reduce((a, b) => a + b, 0) / scores.length;
                lifeSkillsScores[skill] = Math.round(average);
            });

            displayLifeSkillsResults(lifeSkillsScores);
            displayDomainResults(domainScores);
            displayPriorityAreas(domainScores);
            displayActionPlan(domainScores);
        }

        function displayLifeSkillsResults(scores) {
            const container = document.getElementById('lifeSkillsResults');
            container.innerHTML = '';

            Object.entries(scores).forEach(([skill, score]) => {
                const card = document.createElement('div');
                card.className = 'skill-card';
                card.innerHTML = `
                    <div class="skill-name">${skill}</div>
                    <div class="skill-score">${score}%</div>
                `;
                container.appendChild(card);
            });
        }

        function displayDomainResults(scores) {
            const container = document.getElementById('domainResults');
            container.innerHTML = '';

            Object.entries(scores).forEach(([domain, score]) => {
                const bar = document.createElement('div');
                bar.className = 'domain-bar';
                bar.innerHTML = `
                    <div class="domain-bar-name">${domain}</div>
                    <div class="bar-container">
                        <div class="bar-fill" style="width: ${score}%">${score}%</div>
                    </div>
                `;
                container.appendChild(bar);
            });
        }

        function displayPriorityAreas(scores) {
            const lowScoreAreas = Object.entries(scores)
                .filter(([_, score]) => score < 60)
                .sort((a, b) => a[1] - b[1])
                .map(([domain, score]) => ({ domain, score }));

            const container = document.getElementById('priorityAreas');
            
            if (lowScoreAreas.length === 0) {
                container.innerHTML = `
                    <div class="priority-title">üéâ F√©licitations !</div>
                    <p>Vous avez de bons scores dans tous les domaines. Continuez sur cette voie !</p>
                    <p><strong>Conseil :</strong> Choisissez 1 √† 2 domaines o√π vous souhaitez encore progresser pour atteindre l'excellence.</p>
                `;
            } else {
                container.innerHTML = `
                    <div class="priority-title">üéØ Identifiez vos 1 √† 3 domaines prioritaires</div>
                    <p>Voici les domaines o√π vous pourriez concentrer vos efforts :</p>
                    <div style="margin: 10px 0;">
                        ${lowScoreAreas.map(({domain, score}) => `
                            <label style="display:block;margin:6px 0;cursor:pointer;padding:8px 10px;background:#FFFFFF;border-radius:10px;border:1px solid #E5E7EB;">
                                <input type="checkbox" name="priority" value="${domain}" style="margin-right:8px;" onchange="updatePrioritySelection()">
                                <strong>${domain}</strong> (${score}%)
                            </label>
                        `).join('')}
                    </div>
                    <p><em>S√©lectionnez 1 √† 3 domaines sur lesquels vous voulez vous concentrer en priorit√©.</em></p>
                    <div id="selectedPriorities" style="margin-top: 10px; font-weight: 600; color: #1D4ED8;"></div>
                `;
            }
        }

        function updatePrioritySelection() {
            const checkboxes = document.querySelectorAll('input[name="priority"]:checked');
            const selected = Array.from(checkboxes).map(cb => cb.value);
            const display = document.getElementById('selectedPriorities');
            
            if (selected.length > 3) {
                checkboxes[checkboxes.length - 1].checked = false;
                selected.pop();
            }
            
            if (selected.length > 0) {
                display.innerHTML = `‚úÖ Priorit√©s s√©lectionn√©es : ${selected.join(', ')}`;
            } else {
                display.innerHTML = '';
            }
        }

        function displayActionPlan(scores) {
            const container = document.getElementById('actionPlan');
            const recommendations = generateRecommendations(scores);
            container.innerHTML = `
                <div class="action-title">üìã Plan d'action personnalis√©</div>
                <div>${recommendations}</div>
            `;
        }

        function generateRecommendations(scores) {
            const lowScores = Object.entries(scores)
                .filter(([_, score]) => score < 60)
                .sort((a, b) => a[1] - b[1]);

            if (lowScores.length === 0) {
                return `
                    <p><strong>Maintien et d√©veloppement :</strong></p>
                    <ul>
                        <li>Continuez √† d√©velopper vos points forts</li>
                        <li>Partagez vos bonnes pratiques avec d'autres jeunes</li>
                        <li>Fixez-vous de nouveaux d√©fis pour progresser encore</li>
                    </ul>
                `;
            }

            const recommendations = {
                "Emploi": "Participez √† des ateliers CV/lettre de motivation, entra√Ænez-vous aux entretiens",
                "Formation": "Rencontrez un conseiller en orientation, explorez les dispositifs de financement",
                "Orientation": "Faites un bilan de comp√©tences, rencontrez des professionnels du secteur",
                "Mobilit√©": "Explorez les solutions de transport, envisagez le permis de conduire",
                "Sant√©": "Consultez un m√©decin, apprenez des techniques de gestion du stress",
                "Logement": "Contactez les services sociaux, explorez les aides au logement",
                "Citoyennet√©": "Participez √† des activit√©s associatives, d√©veloppez votre r√©seau",
                "Finances": "Suivez un atelier gestion de budget, explorez les aides disponibles",
                "Loisirs": "Inscrivez-vous √† des activit√©s, explorez l'offre culturelle locale",
                "Num√©rique": "Suivez une formation informatique, am√©liorez vos comp√©tences digitales",
                "Mode de vie": "Travaillez sur l'organisation personnelle, √©quilibrez vos activit√©s"
            };

            return `
                <p><strong>Actions prioritaires recommand√©es :</strong></p>
                <ol>
                    ${lowScores.slice(0, 3).map(([domain, _]) => 
                        `<li><strong>${domain}</strong> : ${recommendations[domain] || 'Consultez votre conseiller Mission Locale'}</li>`
                    ).join('')}
                </ol>
                <p><em>Contactez votre conseiller Mission Locale pour mettre en place ces actions.</em></p>
            `;
        }

        async function saveResults() {
            if (currentRecordCount >= 999) {
                showInlineMessage("Limite de 999 diagnostics atteinte. Veuillez supprimer d'anciens diagnostics.", 'error');
                return;
            }

            const saveBtn = document.getElementById('saveBtn');
            const loading = document.getElementById('loading');
            
            saveBtn.disabled = true;
            loading.style.display = 'block';

            try {
                const participantName = document.getElementById('participantName').value;
                
                const domainScores = {};
                domains.forEach((domain, domainIndex) => {
                    const domainResponses = domain.questions.map((_, qIndex) => 
                        responses[`q_${domainIndex}_${qIndex}`] || 0
                    );
                    const average = domainResponses.reduce((a, b) => a + b, 0) / domainResponses.length;
                    domainScores[domain.name] = Math.round((average / 4) * 100);
                });

                const lifeSkillsScores = {};
                Object.keys(lifeSkillsMapping).forEach(skill => {
                    const relatedDomains = lifeSkillsMapping[skill];
                    const scores = relatedDomains.map(domainName => domainScores[domainName]);
                    const average = scores.reduce((a, b) => a + b, 0) / scores.length;
                    lifeSkillsScores[skill] = Math.round(average);
                });

                const priorityAreas = Object.entries(domainScores)
                    .filter(([_, score]) => score < 60)
                    .map(([domain, _]) => domain);

                const assessmentData = {
                    participant_name: participantName,
                    assessment_date: new Date().toISOString(),
                    domain_scores: JSON.stringify(domainScores),
                    life_skills_scores: JSON.stringify(lifeSkillsScores),
                    priority_areas: JSON.stringify(priorityAreas),
                    action_plan: generateRecommendations(domainScores),
                    completed: true
                };

                if (window.dataSdk) {
                    const result = await window.dataSdk.create(assessmentData);
                    
                    if (result.isOk) {
                        showInlineMessage('Diagnostic sauvegard√© avec succ√®s !', 'success');
                    } else {
                        showInlineMessage('Erreur lors de la sauvegarde. Veuillez r√©essayer.', 'error');
                    }
                }
            } catch (error) {
                showInlineMessage('Erreur lors de la sauvegarde. Veuillez r√©essayer.', 'error');
            } finally {
                saveBtn.disabled = false;
                loading.style.display = 'none';
            }
        }

        function restartAssessment() {
            currentDomain = 0;
            responses = {};
            document.getElementById('participantName').value = '';
            showStep('step-welcome');
        }

        function showStep(stepId) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(stepId).classList.add('active');
        }

        function showInlineMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'inline-message';
            
            if (type === 'success') {
                messageDiv.style.background = '#10B981';
            } else if (type === 'error') {
                messageDiv.style.background = '#D72638';
            } else {
                messageDiv.style.background = '#FFA451';
            }
            
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 3500);
        }

        function showActivities() {
            const domainScores = {};
            domains.forEach((domain, domainIndex) => {
                const domainResponses = domain.questions.map((_, qIndex) => 
                    responses[`q_${domainIndex}_${qIndex}`] || 0
                );
                const average = domainResponses.reduce((a, b) => a + b, 0) / domainResponses.length;
                domainScores[domain.name] = Math.round((average / 4) * 100);
            });

            const priorityDomains = Object.entries(domainScores)
                .filter(([_, score]) => score < 60)
                .sort((a, b) => a[1] - b[1])
                .map(([domain, _]) => domain);

            const domainsToShow = priorityDomains.length > 0 
                ? priorityDomains.slice(0, 3)
                : Object.entries(domainScores)
                    .sort((a, b) => a[1] - b[1])
                    .slice(0, 3)
                    .map(([domain, _]) => domain);

            displayActivities(domainsToShow, domainScores);
            showStep('step-activities');
        }

        function displayActivities(priorityDomains, domainScores) {
            const container = document.getElementById('activitiesContainer');
            container.innerHTML = '';

            if (priorityDomains.length === 0) {
                container.innerHTML = `
                    <div class="activity-card">
                        <h3>üéâ Excellent travail !</h3>
                        <p>Vos scores sont tr√®s bons dans tous les domaines. Continuez sur cette voie !</p>
                    </div>
                `;
                return;
            }

            const intro = document.createElement('div');
            intro.className = 'activity-card';
            intro.style.background = '#E0F2FE';
            intro.style.borderLeftColor = '#29B6F6';
            intro.innerHTML = `
                <h3>üéØ Activit√©s recommand√©es pour vous</h3>
                <p>Bas√©es sur vos r√©sultats, voici des activit√©s pratiques pour d√©velopper vos comp√©tences dans les domaines prioritaires :</p>
                <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px;">
                    ${priorityDomains.map(domain => 
                        `<span class="meta-item" style="background:#DBEAFE;color:#1E40AF;">
                            ${domain} (${domainScores[domain]}%)
                        </span>`
                    ).join('')}
                </div>
            `;
            container.appendChild(intro);

            priorityDomains.forEach(domainName => {
                const activities = domainActivities[domainName];
                if (!activities) return;

                activities.forEach(activity => {
                    const activityCard = document.createElement('div');
                    activityCard.className = 'activity-card';
                    
                    const domainIcon = domains.find(d => d.name === domainName)?.icon || 'üéØ';
                    
                    activityCard.innerHTML = `
                        <div class="activity-header">
                            <div class="activity-icon">${domainIcon}</div>
                            <div>
                                <h3 class="activity-title">${activity.title}</h3>
                                <p class="activity-subtitle">Domaine : ${domainName}</p>
                            </div>
                        </div>

                        <p><strong>Objectif :</strong> ${activity.objective}</p>

                        <div class="skills-tags">
                            ${activity.skills.map(skill => 
                                `<span class="skill-tag">Life Skill : ${skill}</span>`
                            ).join('')}
                        </div>

                        <div class="activity-meta">
                            <div class="meta-item">‚è±Ô∏è ${activity.duration}</div>
                            <div class="meta-item">üë• ${activity.format}</div>
                        </div>

                        <div class="activity-steps">
                            <h4>üìã √âtapes de l'activit√© :</h4>
                            <ul class="step-list">
                                ${activity.steps.map(step => 
                                    `<li class="step-item">${step}</li>`
                                ).join('')}
                            </ul>
                        </div>

                        <div class="transfer-note">
                            <div class="transfer-title">üîÑ Transfert Mission Locale :</div>
                            <p>${activity.transfer}</p>
                        </div>
                    `;
                    
                    container.appendChild(activityCard);
                });
            });

            const finalNote = document.createElement('div');
            finalNote.className = 'activity-card';
            finalNote.style.background = '#ECFDF5';
            finalNote.style.borderLeftColor = '#22C55E';
            finalNote.innerHTML = `
                <h4>üí° Pour aller plus loin</h4>
                <p>Ces activit√©s peuvent √™tre anim√©es par votre conseiller Mission Locale ou en groupe avec d'autres jeunes. N'h√©sitez pas √† demander √† organiser ces ateliers !</p>
                <p><strong>Variante collective :</strong> Certaines activit√©s peuvent √™tre r√©alis√©es en groupe avec affichage anonyme des r√©sultats pour favoriser les √©changes sur les d√©fis communs.</p>
            `;
            container.appendChild(finalNote);
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
  </script>
 </body>
</html>
